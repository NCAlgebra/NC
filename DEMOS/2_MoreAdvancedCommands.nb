Notebook[{
Cell[TextData[{"More", " ", "Advanced", " ", "Commands"}], "Section"],
Cell[TextData[{"In", " ", "this", " ", "chapter", " ", "we", " ", "describe", " ", "some", " ", "more", " ", "advance", " ", "features", " ", "and", " ", "commands."}], "Text"],
Cell[TextData[{"If", " ", "you", " ", "want", " ", "a", " ", "living", " ", "version", " ", "of", " ", "this", " ", "chapter", " ", "just", " ", "run", " ", "the", " ", "notebook", " ", Cell[BoxData[FormBox[RowBox[{"NC/DEMOS/2_MoreAdvancedCommands.nb"}], TraditionalForm]]], "."}], "Text"],
Cell["<< NC`
<< NCAlgebra`", "Input"],
Cell[TextData[{"Advanced", " ", "Rules", " ", "and", " ", "Replacements"}], "Subsection"],
Cell[TextData[{"Substitution", " ", "is", " ", "a", " ", "key", " ", "feature", " ", "of", " ", "Symbolic", " ", "computation.", " ", "We", " ", "will", " ", "now", " ", "discuss", " ", "some", " ", "issues", " ", "related", " ", "to", " ", "Mathematica's", " ", "implementation", " ", "of", " ", "rules", " ", "and", " ", "replacements", " ", "that", " ", "can", " ", "affect", " ", "the", " ", "behavior", " ", "of", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "expressions."}], "Text"],
Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"ReplaceAll"}], TraditionalForm]]], " ", "(", Cell[BoxData[FormBox[RowBox[{"/."}], TraditionalForm]]], ")", " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"ReplaceRepeated"}], TraditionalForm]]], " ", "(", Cell[BoxData[FormBox[RowBox[{"//."}], TraditionalForm]]], ")", " ", "often", " ", "fail"}], "Subsubsection"],
Cell[TextData[{"The", " ", "first", " ", "issue", " ", "is", " ", "related", " ", "to", " ", "how", " ", "Mathematica", " ", "performs", " ", "substitutions,", " ", "which", " ", "is", " ", "through", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{"pattern", " ", "matching"}], "Text"]}]], FontSlant->"Italic"], "http://reference.wolfram.com/language/guide/RulesAndPatterns.html"]], ".", " ", "For", " ", "a", " ", "rule", " ", "to", " ", "be", " ", "effective", " ", "if", " ", "has", " ", "to", " ", "match", " ", "the", " ", StyleBox[Cell[TextData[{Cell[TextData[{"structural"}], "Text"]}]], FontSlant->"Italic"], " ", "representation", " ", "of", " ", "an", " ", "expression.", " ", "That", " ", "representation", " ", "might", " ", "be", " ", "different", " ", "than", " ", "one", " ", "would", " ", "normally", " ", "think", " ", "based", " ", "on", " ", "the", " ", "usual", " ", "properties", " ", "of", " ", "mathematical", " ", "operators.", " ", "For", " ", "example,", " ", "one", " ", "would", " ", "expect", " ", "the", " ", "rule:"}], "Text"],
Cell["rule = 1 + x_ -> x", "Output"],
Cell[TextData[{"to", " ", "match", " ", "all", " ", "the", " ", "expressions", " ", "bellow:"}], "Text"],
Cell["1 + a
1 + 2 a
1 + a + b
1 + 2 a * b", "Output"],
Cell[TextData[{"so", " ", "that"}], "Text"],
Cell["expr /. rule", "Output"],
Cell[TextData[{"with", " ", Cell[BoxData[FormBox[RowBox[{"expr"}], TraditionalForm]]], " ", "taking", " ", "the", " ", "above", " ", "expressions", " ", "would", " ", "result", " ", "in:"}], "Text"],
Cell["a
2 a
a + b
2 a * b", "Output"],
Cell[TextData[{"Indeed,", " ", "Mathematica's", " ", "attribute", " ", Cell[BoxData[FormBox[RowBox[{"Flat"}], TraditionalForm]]], " ", "does", " ", "precisely", " ", "that.", " ", "Note", " ", "that", " ", "this", " ", "is", " ", "still", " ", StyleBox[Cell[TextData[{Cell[TextData[{"structural", " ", "matching"}], "Text"]}]], FontSlant->"Italic"], ",", " ", "not", " ", StyleBox[Cell[TextData[{Cell[TextData[{"mathematical", " ", "matching"}], "Text"]}]], FontSlant->"Italic"], ",", " ", "since", " ", "the", " ", "pattern", " ", Cell[BoxData[FormBox[RowBox[{"1 + x_"}], TraditionalForm]]], " ", "would", " ", "not", " ", "match", " ", "an", " ", "integer", " ", Cell[BoxData[FormBox[RowBox[{"2"}], TraditionalForm]]], ",", " ", "even", " ", "though", " ", "one", " ", "could", " ", "write", " ", Cell[BoxData[FormBox[RowBox[{"2 = 1 + 1"}], TraditionalForm]]], "!"}], "Text"],
Cell[TextData[{"Unfortunately,", " ", Cell[BoxData[FormBox[RowBox[{"**"}], TraditionalForm]]], ",", " ", "which", " ", "is", " ", "the", " ", Cell[BoxData[FormBox[RowBox[{"NonCommutativeMultiply"}], TraditionalForm]]], " ", "operator,", " ", StyleBox[Cell[TextData[{Cell[TextData[{"is", " ", "not"}], "Text"]}]], FontSlant->"Italic"], " ", Cell[BoxData[FormBox[RowBox[{"Flat"}], TraditionalForm]]], (* See [^1] *), ".", " ", "This", " ", "is", " ", "the", " ", "reason", " ", "why", " ", "substitution", " ", "based", " ", "on", " ", "a", " ", "simple", " ", "rule", " ", "such", " ", "as:"}], "Text"],
Cell["rule = a**b -> c", "Input"],
Cell[TextData[{"so", " ", "that"}], "Text"],
Cell["expr /. rule", "Output"],
Cell[TextData[{"will", " ", "work", " ", "for", " ", "some", " ", Cell[BoxData[FormBox[RowBox[{"expr"}], TraditionalForm]]], " ", "like"}], "Text"],
Cell["1 + 2 a**b /. rule", "Input"],
Cell[TextData[{"resulting", " ", "in"}], "Text"],
Cell["1 + 2 c", "Output"],
Cell[TextData[{"but", " ", "will", " ", "fail", " ", "to", " ", "produce", " ", "the", " ", StyleBox[Cell[TextData[{Cell[TextData[{"expected"}], "Text"]}]], FontSlant->"Italic"], " ", "result", " ", "in", " ", "cases", " ", "like:"}], "Text"],
Cell["a**b**c /. rule", "Input"],
Cell[TextData[{"or"}], "Text"],
Cell["c**a**b /. rule
c**a**b**d /. rule
1 + 2 a**b**c /. rule", "Input"],
Cell[TextData[{"That's", " ", "what", " ", "the", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "family", " ", "of", " ", "replacement", " ", "functions", " ", "discussed", " ", "in", " ", "the", " ", "next", " ", "section", " ", "are", " ", "made", " ", "for."}], "Text"],
Cell[TextData[{"The", " ", "fix", " ", "is", " ", Cell[BoxData[FormBox[RowBox[{"NCReplace"}], TraditionalForm]]]}], "Subsubsection"],
Cell[TextData[{"Continuing", " ", "with", " ", "the", " ", "example", " ", "in", " ", "the", " ", "previous", " ", "section,", " ", "the", " ", "calls"}], "Text"],
Cell["NCReplaceAll[a**b**c, rule]
NCReplaceAll[ c**a**b, rule ]
NCReplaceAll[c**a**b**d, rule]
NCReplaceAll[1 + 2 a**b**c, rule ]", "Input"],
Cell[TextData[{"produce", " ", "the", " ", "results", " ", "one", " ", "would", " ", "expect:"}], "Text"],
Cell["c^2
c^2
c^2**d
1 + 2 c^2", "Output"],
Cell[TextData[{"For", " ", "this", " ", "reason,", " ", "when", " ", "substituting", " ", "in", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "it", " ", "is", " ", "always", " ", "safer", " ", "to", " ", "use", " ", "functions", " ", "from", " ", "the", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"NCReplace"}], TraditionalForm]]], " ", "package"}], "Text"]}]], FontSlant->"Italic"], "PackageNCReplace"]], " ", "rather", " ", "than", " ", "the", " ", "corresponding", " ", "Mathematica", " ", Cell[BoxData[FormBox[RowBox[{"Replace"}], TraditionalForm]]], " ", "family", " ", "of", " ", "functions.", " ", "Unfortunately,", " ", "this", " ", "comes", " ", "at", " ", "a", " ", "the", " ", "expense", " ", "of", " ", "sacrificing", " ", "the", " ", "standard", " ", "operators", " ", Cell[BoxData[FormBox[RowBox[{"/."}], TraditionalForm]]], " ", "(", Cell[BoxData[FormBox[RowBox[{"ReplaceAll"}], TraditionalForm]]], ")", " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"//."}], TraditionalForm]]], " ", "(", Cell[BoxData[FormBox[RowBox[{"ReplaceRepeated"}], TraditionalForm]]], "),", " ", "which", " ", "cannot", " ", "be", " ", "safely", " ", "overloaded,", " ", "forcing", " ", "one", " ", "to", " ", "use", " ", "the", " ", "full", " ", "names", " ", Cell[BoxData[FormBox[RowBox[{"NCReplaceAll"}], TraditionalForm]]], " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"NCReplaceRepeated"}], TraditionalForm]]], "."}], "Text"],
Cell[TextData[{"On", " ", "the", " ", "same", " ", "vein,", " ", "the", " ", "following", " ", "substitution", " ", "rule"}], "Text"],
Cell["NCReplaceAll[2 a**b + c, 2 a -> b]", "Input"],
Cell[TextData[{"will", " ", "return", " ", Cell[BoxData[FormBox[RowBox[{"2 a**b + c"}], TraditionalForm]]], " ", "intact", " ", "since"}], "Text"],
Cell["FullForm[2 a**b]", "Input"],
Cell[TextData[{"is", " ", "actually"}], "Text"],
Cell["Times[2, NonCommutativeMuliply[a, b]]", "Output"],
Cell[TextData[{"which", " ", "is", " ", "not", " ", "structurally", " ", "related", " ", "to"}], "Text"],
Cell["FullForm[2 a]", "Input"],
Cell[TextData[{"which", " ", "is"}], "Text"],
Cell["Times[2, a]", "Output"],
Cell[TextData[{"Of", " ", "course,", " ", "in", " ", "this", " ", "case", " ", "a", " ", "simple", " ", "solution", " ", "is", " ", "to", " ", "use", " ", "the", " ", "alternative", " ", "rule:"}], "Text"],
Cell["NCReplaceAll[2 a**b + c, a -> b / 2]", "Input"],
Cell[TextData[{"which", " ", "results", " ", "in", " ", Cell[BoxData[FormBox[RowBox[{"b^2 + c"}], TraditionalForm]]], ",", " ", "as", " ", "one", " ", "might", " ", "expect."}], "Text"],
Cell[TextData[{"Matching", " ", "monomials", " ", "with", " ", "powers"}], "Subsubsection"],
Cell[TextData[{"Starting", " ", "with", " ", StyleBox[Cell[TextData[{Cell[TextData[{"Version", " ", "6"}], "Text"]}]], FontWeight->"Bold"], ",", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "stores", " ", "repeated", " ", "symbols", " ", "in", " ", "noncommutative", " ", "monomials", " ", "using", " ", "powers.", " ", "This", " ", "means", " ", "that"}], "Text"],
Cell["expr = a**a**a**b**a**a**b**a**b
FullForm[expr]", "Input"],
Cell[TextData[{"is", " ", "internally", " ", "stored", " ", "as"}], "Text"],
Cell["NonCommutativeMultiply[a^3, b, a^2, b, a, b]", "Output"],
Cell[TextData[{"so", " ", "that", " ", "a", " ", "replacement", " ", "such", " ", "as"}], "Text"],
Cell["NCReplaceAll[expr, a**b -> c, ApplyPowerRule -> False]", "Input"],
Cell[TextData[{"will", " ", "result", " ", "in"}], "Text"],
Cell["a^3**b**a^2**b**c", "Output"],
Cell[TextData[{"Note", " ", "how", " ", "the", " ", "rule", " ", "fails", " ", "to", " ", "match", " ", "the", " ", Cell[BoxData[FormBox[RowBox[{"a**b"}], TraditionalForm]]], " ", "in", " ", "the", " ", "terms", " ", Cell[BoxData[FormBox[RowBox[{"a**b^2"}], TraditionalForm]]], " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"a**b^3"}], TraditionalForm]]], ".", " ", "This", " ", "situation", " ", "might", " ", "be", " ", "familiar", " ", "to", " ", "an", " ", "experienced", " ", "Mathematica", " ", "user", " ", "who", " ", "is", " ", "a", " ", "aware", " ", "of", " ", "the", " ", "difference", " ", "between", " ", "structural", " ", "pattern", " ", "matching", " ", "and", " ", "mathematical", " ", "matching", (* See [^2] *), "."}], "Text"],
Cell[TextData[{"As", " ", "a", " ", "convenience", " ", "for", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "users,", " ", StyleBox[Cell[TextData[{Cell[TextData[{"Version", " ", "6"}], "Text"]}]], FontWeight->"Bold"], " ", "provides", " ", "the", " ", "function", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{"NCReplacePowerRule"}], "Text"]}]], FontSlant->"Italic"], "NCReplacePowerRule"]], " ", "that", " ", "modifies", " ", "a", " ", "user's", " ", "rule", " ", "in", " ", "order", " ", "to", " ", "accomplish", " ", "matching", " ", "of", " ", "symbols", " ", "in", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "expressions", " ", "including", " ", "powers.", " ", "For", " ", "example,", " ", "for", " ", "the", " ", "same", " ", Cell[BoxData[FormBox[RowBox[{"expr"}], TraditionalForm]]], " ", "above,", " ", "the", " ", "following", " ", "replacement"}], "Text"],
Cell["NCReplaceAll[expr, NCReplacePowerRule[a**b -> c], ApplyPowerRule -> False]", "Input"],
Cell[TextData[{"will", " ", "produce", " ", "the", " ", "more", " ", "familiar"}], "Text"],
Cell["a^2**c**a^2**b**a**b", "Output"],
Cell[TextData[{"after", " ", "matching", " ", Cell[BoxData[FormBox[RowBox[{"a**b"}], TraditionalForm]]], " ", "in", " ", "the", " ", "term", " ", Cell[BoxData[FormBox[RowBox[{"a^3**b"}], TraditionalForm]]], ",", " ", "and"}], "Text"],
Cell["NCReplaceRepeated[expr, NCReplacePowerRule[a**b -> c], ApplyPowerRule -> False]", "Input"],
Cell[TextData[{"will", " ", "produce"}], "Text"],
Cell["a^2**c**a**c^2", "Output"],
Cell[TextData[{"after", " ", "matching", " ", Cell[BoxData[FormBox[RowBox[{"a**b"}], TraditionalForm]]], " ", "in", " ", Cell[BoxData[FormBox[RowBox[{"a^3**b"}], TraditionalForm]]], ",", " ", Cell[BoxData[FormBox[RowBox[{"a^2**b"}], TraditionalForm]]], ",", " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"a**b"}], TraditionalForm]]], "."}], "Text"],
Cell[TextData[{"The", " ", "command", " ", Cell[BoxData[FormBox[RowBox[{"NCReplacePowerRule"}], TraditionalForm]]], " ", "works", " ", "by", " ", "modifying", " ", "noncommutative", " ", "patterns", " ", "with", " ", "symbols", " ", "appearing", " ", "at", " ", "the", " ", "edges", " ", "of", " ", "monomials", " ", "to", " ", "account", " ", "for", " ", "the", " ", "potential", " ", "presence", " ", "of", " ", Cell[BoxData[FormBox[RowBox[{"Power"}], TraditionalForm]]], " ", "in", " ", "a", " ", "noncommutative", " ", "monomial.", " ", "For", " ", "example,"}], "Text"],
Cell["NCReplacePowerRule[a**c**b -> d]", "Input"],
Cell[TextData[{"produces", " ", "the", " ", "modified", " ", "rule", (* See [^3] *)}], "Text"],
Cell["a^n_.**c**b^m_. -> a^(n-1)**d**b^(m-1)", "Output"],
Cell[TextData[{"which", " ", "can", " ", "successfully", " ", "match", " ", "powers", " ", "of", " ", "the", " ", "symbols", " ", Cell[BoxData[FormBox[RowBox[{"a"}], TraditionalForm]]], " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"b"}], TraditionalForm]]], " ", "appearing", " ", "in", " ", "the", " ", "monomial", " ", Cell[BoxData[FormBox[RowBox[{"a**c**b"}], TraditionalForm]]], "."}], "Text"],
Cell[TextData[{"The", " ", "application", " ", "of", " ", Cell[BoxData[FormBox[RowBox[{"NCReplacePowerRule"}], TraditionalForm]]], " ", "can", " ", "also", " ", "be", " ", "done", " ", "by", " ", "invoking", " ", "the", " ", "option", " ", Cell[BoxData[FormBox[RowBox[{"ApplyPowerRule"}], TraditionalForm]]], ",", " ", "which", " ", "is", " ", "available", " ", "in", " ", "all", " ", "functions", " ", "of", " ", "the", " ", "package", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{"NCReplace"}], "Text"]}]], FontSlant->"Italic"], "PackageNCReplace"]], ".", " ", "Currently,", " ", Cell[BoxData[FormBox[RowBox[{"ApplyPowerRule"}], TraditionalForm]]], " ", "is", " ", "set", " ", "to", " ", Cell[BoxData[FormBox[RowBox[{"True"}], TraditionalForm]]], " ", "by", " ", "default", " ", "so", " ", "that", " ", "the", " ", "commands"}], "Text"],
Cell["NCReplaceRepeated[expr, a**b -> c]
NCReplaceRepeated[expr, a**b -> c, ApplyPowerRule -> True]", "Input"],
Cell[TextData[{"do", " ", "the", " ", "same", " ", "thing", " ", "as"}], "Text"],
Cell["NCReplaceRepeated[expr, NCReplacePowerRule[a**b -> c], ApplyPowerRule -> False]", "Input"],
Cell[TextData[{"This", " ", "option", " ", "can", " ", "also", " ", "be", " ", "turned", " ", "off", " ", "globally", " ", "for", " ", "all", " ", "calls", " ", "to", " ", "the", " ", Cell[BoxData[FormBox[RowBox[{"NCReplace"}], TraditionalForm]]], " ", "family", " ", "of", " ", "functions", " ", "in", " ", "a", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "session", " ", "by", " ", "calling"}], "Text"],
Cell["SetOptions[NCReplace, ApplyPowerRule -> False];", "Input"],
Cell[TextData[{"After", " ", "that,", " ", "all", " ", "calls", " ", "to", " ", Cell[BoxData[FormBox[RowBox[{"NCReplace"}], TraditionalForm]]], ",", " ", Cell[BoxData[FormBox[RowBox[{"NCReplaceAll"}], TraditionalForm]]], ",", " ", Cell[BoxData[FormBox[RowBox[{"NCReplaceRepeated"}], TraditionalForm]]], ",", " ", "and", " ", "related", " ", "function,", " ", "will", " ", "be", " ", "done", " ", "with", " ", "the", " ", "option", " ", Cell[BoxData[FormBox[RowBox[{"ApplyPowerRule -> False"}], TraditionalForm]]], " ", "automatically."}], "Text"],
Cell[TextData[{"To", " ", "revert", " ", "to", " ", "the", " ", "default", " ", "behavior", " ", "just", " ", "set"}], "Text"],
Cell["SetOptions[NCReplace, ApplyPowerRule -> True];", "Input"],
Cell[TextData[{"Trouble", " ", "with", " ", Cell[BoxData[FormBox[RowBox[{"Block"}], TraditionalForm]]], " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"Module"}], TraditionalForm]]]}], "Subsubsection"],
Cell[TextData[{"A", " ", "second", " ", "more", " ", "esoteric", " ", "issue", " ", "related", " ", "to", " ", "substitution", " ", "in", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "does", " ", "not", " ", "have", " ", "a", " ", "clean", " ", "solution.", " ", "It", " ", "is", " ", "also", " ", "one", " ", "that", " ", "usually", " ", "lurks", " ", "in", " ", "hidden", " ", "pieces", " ", "of", " ", "code", " ", "and", " ", "can", " ", "be", " ", "very", " ", "difficult", " ", "to", " ", "spot.", " ", "We", " ", "have", " ", "been", " ", "victim", " ", "of", " ", "such", " ", "\"", Cell[TextData[{"bugs"}], "Text"], "\"", " ", "many", " ", "times.", " ", "Luckily", " ", "it", " ", "only", " ", "affect", " ", "advanced", " ", "users", " ", "that", " ", "are", " ", "using", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "inside", " ", "their", " ", "own", " ", "functions", " ", "using", " ", "Mathematica's", " ", Cell[BoxData[FormBox[RowBox[{"Block"}], TraditionalForm]]], " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"Module"}], TraditionalForm]]], " ", "constructions.", " ", "It", " ", "is", " ", "also", " ", "not", " ", "a", " ", "real", " ", "bug,", " ", "since", " ", "it", " ", "follows", " ", "from", " ", "some", " ", "often", " ", "not", " ", "well", " ", "understood", " ", "issues", " ", "with", " ", "the", " ", "usage", " ", "of", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"Block"}], TraditionalForm]]], " ", "versus", " ", Cell[BoxData[FormBox[RowBox[{"Module"}], TraditionalForm]]]}], "Text"]}]], FontSlant->"Italic"], "http://reference.wolfram.com/language/tutorial/BlocksComparedWithModules.html"]], ".", " ", "Our", " ", "goal", " ", "here", " ", "is", " ", "therefore", " ", "not", " ", "to", " ", StyleBox[Cell[TextData[{Cell[TextData[{"fix"}], "Text"]}]], FontSlant->"Italic"], " ", "the", " ", "issue", " ", "but", " ", "simply", " ", "to", " ", "alert", " ", "advanced", " ", "users", " ", "of", " ", "its", " ", "existence.", " ", "Start", " ", "by", " ", "first", " ", "revisiting", " ", "the", " ", "following", " ", "example", " ", "from", " ", "the", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{"Mathematica", " ", "documentation"}], "Text"]}]], FontSlant->"Italic"], "http://reference.wolfram.com/language/tutorial/BlocksComparedWithModules.html"]], ".", " ", "Let"}], "Text"],
Cell["m = i^2", "Input"],
Cell[TextData[{"and", " ", "run"}], "Text"],
Cell["Block[{i = a}, i + m]", "Input"],
Cell[TextData[{"which", " ", "returns", " ", "the", " ", "\"", Cell[TextData[{"expected"}], "Text"], "\""}], "Text"],
Cell["a + a^2", "Output"],
Cell[TextData[{"versus"}], "Text"],
Cell["Module[{i = a}, i + m]", "Input"],
Cell[TextData[{"which", " ", "returns", " ", "the", " ", "\"", Cell[TextData[{"surprising"}], "Text"], "\""}], "Text"],
Cell["a + i**i", "Output"],
Cell[TextData[{"The", " ", "reason", " ", "for", " ", "this", " ", "behavior", " ", "is", " ", "that", " ", Cell[BoxData[FormBox[RowBox[{"Block"}], TraditionalForm]]], " ", "effectively", " ", "evaluates", " ", Cell[BoxData[FormBox[RowBox[{"i"}], TraditionalForm]]], " ", "as", " ", "a", " ", StyleBox[Cell[TextData[{Cell[TextData[{"local", " ", "variable"}], "Text"]}]], FontSlant->"Italic"], " ", "and", " ", "evaluates", " ", Cell[BoxData[FormBox[RowBox[{"m"}], TraditionalForm]]], " ", "using", " ", "whatever", " ", "values", " ", "are", " ", "available", " ", "at", " ", "the", " ", "time", " ", "of", " ", "evaluation,", " ", "whereas", " ", Cell[BoxData[FormBox[RowBox[{"Module"}], TraditionalForm]]], " ", "only", " ", "evaluates", " ", "the", " ", "symbol", " ", Cell[BoxData[FormBox[RowBox[{"i"}], TraditionalForm]]], " ", "which", " ", "appears", " ", StyleBox[Cell[TextData[{Cell[TextData[{"explicitly"}], "Text"]}]], FontSlant->"Italic"], " ", "in", " ", Cell[BoxData[FormBox[RowBox[{"i + m"}], TraditionalForm]]], " ", "and", " ", "not", " ", Cell[BoxData[FormBox[RowBox[{"m"}], TraditionalForm]]], " ", "using", " ", "the", " ", "local", " ", "value", " ", "of", " ", Cell[BoxData[FormBox[RowBox[{"i = a"}], TraditionalForm]]], ".", " ", "This", " ", "can", " ", "lead", " ", "to", " ", "many", " ", "surprises", " ", "when", " ", "using", " ", "rules", " ", "and", " ", "substitution", " ", "inside", " ", "a", " ", Cell[BoxData[FormBox[RowBox[{"Module"}], TraditionalForm]]], ".", " ", "For", " ", "example:"}], "Text"],
Cell["Block[{i = a}, i_ -> i]", "Input"],
Cell[TextData[{"will", " ", "return"}], "Text"],
Cell["i_ -> a", "Output"],
Cell[TextData[{"whereas"}], "Text"],
Cell["Module[{i = a}, i_ -> i]", "Input"],
Cell[TextData[{"will", " ", "return"}], "Text"],
Cell["i_ -> i", "Output"],
Cell[TextData[{"More", " ", "devastating", " ", "for", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "is", " ", "the", " ", "fact", " ", "that", " ", Cell[BoxData[FormBox[RowBox[{"Module"}], TraditionalForm]]], " ", "will", " ", "hide", " ", "local", " ", "definitions", " ", "from", " ", "rules,", " ", "which", " ", "will", " ", "often", " ", "lead", " ", "to", " ", "disaster", " ", "if", " ", "local", " ", "variables", " ", "need", " ", "to", " ", "be", " ", "declared", " ", "noncommutative.", " ", "Consider", " ", "for", " ", "example", " ", "the", " ", "trivial", " ", "definitions", " ", "for", " ", Cell[BoxData[FormBox[RowBox[{"F"}], TraditionalForm]]], " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"G"}], TraditionalForm]]], " ", "below:"}], "Text"],
Cell["F[exp_] := Module[
  {rule, aa, bb},
  SetNonCommutative[aa, bb];
  rule = aa_**bb_ -> bb**aa;
  NCReplaceAll[exp, rule]
]

G[exp_] := Block[
  {rule, aa, bb},
  SetNonCommutative[aa, bb];
  rule = aa_**bb_ -> bb**aa;
  NCReplaceAll[exp, rule]
]", "Input"],
Cell[TextData[{"Their", " ", "only", " ", "difference", " ", "is", " ", "that", " ", "one", " ", "is", " ", "defined", " ", "using", " ", "a", " ", Cell[BoxData[FormBox[RowBox[{"Block"}], TraditionalForm]]], " ", "and", " ", "the", " ", "other", " ", "is", " ", "defined", " ", "using", " ", "a", " ", Cell[BoxData[FormBox[RowBox[{"Module"}], TraditionalForm]]], ".", " ", "The", " ", "task", " ", "is", " ", "to", " ", "apply", " ", "a", " ", "rule", " ", "that", " ", StyleBox[Cell[TextData[{Cell[TextData[{"flips"}], "Text"]}]], FontSlant->"Italic"], " ", "the", " ", "noncommutative", " ", "product", " ", "of", " ", "their", " ", "arguments,", " ", "say,", " ", Cell[BoxData[FormBox[RowBox[{"x**y"}], TraditionalForm]]], ",", " ", "into", " ", Cell[BoxData[FormBox[RowBox[{"y**x"}], TraditionalForm]]], ".", " ", "The", " ", "problem", " ", "is", " ", "that", " ", "only", " ", "one", " ", "of", " ", "those", " ", "definitions", " ", "work", " ", "\"", Cell[TextData[{"as", " ", "expected."}], "Text"], "\"", " ", "Indeed,", " ", "verify", " ", "that"}], "Text"],
Cell["G[x**y]", "Input"],
Cell[TextData[{"returns", " ", "the", " ", "\"", Cell[TextData[{"expected"}], "Text"], "\""}], "Text"],
Cell["y**x", "Output"],
Cell[TextData[{"whereas"}], "Text"],
Cell["F[x**y]", "Input"],
Cell[TextData[{"returns"}], "Text"],
Cell["x y", "Output"],
Cell[TextData[{"which", " ", "completely", " ", "destroys", " ", "the", " ", "noncommutative", " ", "product.", " ", "The", " ", "reason", " ", "for", " ", "the", " ", "catastrophic", " ", "failure", " ", "of", " ", "the", " ", "definition", " ", "of", " ", Cell[BoxData[FormBox[RowBox[{"F"}], TraditionalForm]]], ",", " ", "which", " ", "is", " ", "inside", " ", "a", " ", Cell[BoxData[FormBox[RowBox[{"Module"}], TraditionalForm]]], ",", " ", "is", " ", "that", " ", "the", " ", "letters", " ", Cell[BoxData[FormBox[RowBox[{"aa"}], TraditionalForm]]], " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"bb"}], TraditionalForm]]], " ", "appearing", " ", "in", " ", Cell[BoxData[FormBox[RowBox[{"rule"}], TraditionalForm]]], " ", "are", " ", StyleBox[Cell[TextData[{Cell[TextData[{"not", " ", "treated", " ", "as", " ", "the", " ", "local", " ", "symbols", " ", Cell[BoxData[FormBox[RowBox[{"aa"}], TraditionalForm]]], " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"bb"}], TraditionalForm]]]}], "Text"]}]], FontSlant->"Italic"], (* See [^4] *), ".", " ", "For", " ", "this", " ", "reason,", " ", "the", " ", "right-hand", " ", "side", " ", "of", " ", "the", " ", "rule", " ", Cell[BoxData[FormBox[RowBox[{"rule"}], TraditionalForm]]], " ", "involves", " ", "the", " ", "global", " ", "symbols", " ", Cell[BoxData[FormBox[RowBox[{"aa"}], TraditionalForm]]], " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"bb"}], TraditionalForm]]], ",", " ", "which", " ", "are,", " ", "in", " ", "the", " ", "absence", " ", "of", " ", "a", " ", "declaration", " ", "to", " ", "the", " ", "contrary,", " ", "commutative.", " ", "On", " ", "the", " ", "other", " ", "hand,", " ", "the", " ", "definition", " ", "of", " ", Cell[BoxData[FormBox[RowBox[{"G"}], TraditionalForm]]], " ", "inside", " ", "a", " ", Cell[BoxData[FormBox[RowBox[{"Block"}], TraditionalForm]]], " ", "makes", " ", "sure", " ", "that", " ", Cell[BoxData[FormBox[RowBox[{"aa"}], TraditionalForm]]], " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"bb"}], TraditionalForm]]], " ", "are", " ", "evaluated", " ", "with", " ", "whatever", " ", "value", " ", "they", " ", "might", " ", "have", " ", "locally", " ", "at", " ", "the", " ", "time", " ", "of", " ", "execution."}], "Text"],
Cell[TextData[{"The", " ", "above", " ", "subtlety", " ", "often", " ", "manifests", " ", "itself", " ", "partially,", " ", "sometimes", " ", "causing", " ", "what", " ", "might", " ", "be", " ", "perceived", " ", "as", " ", "some", " ", "kind", " ", "of", " ", StyleBox[Cell[TextData[{Cell[TextData[{"erratic", " ", "behavior"}], "Text"]}]], FontSlant->"Italic"], ".", " ", "Indeed,", " ", "if", " ", "one", " ", "had", " ", "used", " ", "symbols", " ", "that", " ", "were", " ", "already", " ", "declared", " ", "globally", " ", "noncommutative", " ", "by", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], ",", " ", "such", " ", "as", " ", "single", " ", "small", " ", "cap", " ", "roman", " ", "letters", " ", "as", " ", "in", " ", "the", " ", "definition:"}], "Text"],
Cell["H[exp_] := Module[
  {rule, a, b},
  SetNonCommutative[a, b];
  rule = a_**b_ -> b**a;
  NCReplaceAll[exp, rule]
]", "Input"],
Cell[TextData[{"then", " ", "calling"}], "Text"],
Cell["H[x**y]", "Input"],
Cell[TextData[{"works", " ", "\"", Cell[TextData[{"as", " ", "expected,"}], "Text"], "\"", " ", "even", " ", "if", " ", "for", " ", "the", " ", "wrong", " ", "reasons!"}], "Text"],
Cell[TextData[{"Another", " ", "possible", " ", "\"", Cell[TextData[{"fix"}], "Text"], "\"", " ", "is", " ", "to", " ", "use", " ", "a", " ", "delayed", " ", "rule,", " ", "as", " ", "in:"}], "Text"],
Cell["H[exp_] := Module[
  {rule, aa, bb},
  SetNonCommutative[aa, bb];
  rule = aa_**bb_ :> bb**aa;
  NCReplaceAll[exp, rule]
]", "Input"],
Cell[TextData[{"with", " ", "which"}], "Text"],
Cell["H[x**y]", "Input"],
Cell[TextData[{"would", " ", "also", " ", "work", " ", "because", " ", "the", " ", "evaluation", " ", "of", " ", "the", " ", "right-hand", " ", "side", " ", "of", " ", "the", " ", "rule", " ", "is", " ", "delayed", " ", "until", " ", "the", " ", "time", " ", "of", " ", "its", " ", "application."}], "Text"],
Cell[TextData[{"Expanding", " ", "matrix", " ", "products"}], "Subsection"],
Cell[TextData[{"Starting", " ", "at", " ", StyleBox[Cell[TextData[{Cell[TextData[{"Version", " ", "5"}], "Text"]}]], FontWeight->"Bold"], " ", "the", " ", "operators", " ", Cell[BoxData[FormBox[RowBox[{"**"}], TraditionalForm]]], " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"inv"}], TraditionalForm]]], " ", "apply", " ", "also", " ", "to", " ", "matrices.", " ", "However,", " ", "in", " ", "order", " ", "for", " ", Cell[BoxData[FormBox[RowBox[{"**"}], TraditionalForm]]], " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"inv"}], TraditionalForm]]], " ", "to", " ", "continue", " ", "to", " ", "work", " ", "as", " ", "full", " ", "fledged", " ", "operators,", " ", "the", " ", "result", " ", "of", " ", "multiplications", " ", "or", " ", "inverses", " ", "of", " ", "matrices", " ", "is", " ", "held", " ", "unevaluated", " ", "until", " ", "the", " ", "user", " ", "calls", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"NCMatrixExpand"}], TraditionalForm]]]}], "Text"]}]], FontSlant->"Italic"], "NCMatrixExpand"]], ".", " ", "This", " ", "is", " ", "in", " ", "the", " ", "the", " ", "same", " ", "spirit", " ", "as", " ", "good", " ", "old", " ", "fashion", " ", "commutative", " ", "operations", " ", "in", " ", "Mathematica."}], "Text"],
Cell[TextData[{"For", " ", "example,", " ", "with"}], "Text"],
Cell["m1 = {{a, b}, {c, d}}
m2 = {{d, 2}, {e, 3}}", "Input"],
Cell[TextData[{"the", " ", "call"}], "Text"],
Cell["m1**m2", "Input"],
Cell[TextData[{"results", " ", "in"}], "Text"],
Cell["{{a, b}, {c, d}}**{{d, 2}, {e, 3}}", "Output"],
Cell[TextData[{"Upon", " ", "calling"}], "Text"],
Cell["m1**m2 // NCMatrixExpand", "Input"],
Cell[TextData[{"the", " ", "matrix", " ", "product", " ", "evaluation", " ", "takes", " ", "place", " ", "returning"}], "Text"],
Cell["{{a**d + b**e, 2a + 3b}, {c**d + d**e, 2c + 3d}}", "Output"],
Cell[TextData[{"which", " ", "is", " ", "what", " ", "would", " ", "have", " ", "arisen", " ", "from", " ", "calling", " ", Cell[BoxData[FormBox[RowBox[{"NCDot[m1,m2]"}], TraditionalForm]]], (* See [^5] *), ".", " ", "Likewise"}], "Text"],
Cell["inv[m1]", "Input"],
Cell[TextData[{"results", " ", "in"}], "Text"],
Cell["inv[{{a, b}, {c, d}}]", "Output"],
Cell[TextData[{"and"}], "Text"],
Cell["inv[m1] // NCMatrixExpand", "Input"],
Cell[TextData[{"returns", " ", "the", " ", "evaluated", " ", "result"}], "Text"],
Cell["{{inv[a]**(1 + b**inv[d - c**inv[a]**b]**c**inv[a]), -inv[a]**b**inv[d - c**inv[a]**b]}, 
 {-inv[d - c**inv[a]**b]**c**inv[a], inv[d - c**inv[a]**b]}}", "Output"],
Cell[TextData[{"or,", " ", "using", " ", Cell[BoxData[FormBox[RowBox[{"MatrixForm"}], TraditionalForm]]], ":"}], "Text"],
Cell["inv[m1] // NCMatrixExpand // MatrixForm", "Input"],
Cell[TextData[{"returns"}], "Text"],
Cell[TextData[{Cell[ToExpression["\\begin{bmatrix} a^{-1} (1 + b (d - c a^{-1} b)^{-1} c a^{-1}) & -a^{-1} b (d - c a^{-1} b)^{-1} \\\\ -(d - c a^{-1} b)^{-1} c a^{-1} & (d - c a^{-1} b)^{-1} \\end{bmatrix}", TeXForm]]}], "Text"],
Cell[TextData[{"A", " ", "less", " ", "trivial", " ", "example", " ", "is"}], "Text"],
Cell["m3 = m1**inv[IdentityMatrix[2] + m1] - inv[IdentityMatrix[2] + m1]**m1", "Input"],
Cell[TextData[{"that", " ", "returns"}], "Text"],
Cell["-inv[{{1 + a, b}, {c, 1 + d}}]**{{a, b}, {c, d}} + 
     {{a, b}, {c, d}}**inv[{{1 + a, b}, {c, 1 + d}}]", "Output"],
Cell[TextData[{"Expanding"}], "Text"],
Cell["NCMatrixExpand[m3]", "Input"],
Cell[TextData[{"results", " ", "in"}], "Text"],
Cell["{{b**inv[b - (1 + a)**inv[c]**(1 + d)] - inv[c]**(1 + (1 + d)**inv[b - 
    (1 + a)**inv[c]**(1 + d)]**(1 + a)**inv[c])**c - a**inv[c]**(1 + d)**inv[b - 
    (1 + a)**inv[c]**(1 + d)] + inv[c]**(1 + d)**inv[b - (1 + a)**inv[c]**(1 + d)]**a, 
  a**inv[c]**(1 + (1 + d)**inv[b - (1 + a)**inv[c]**(1 + d)]**(1 + a)**inv[c]) - 
    inv[c]**(1 + (1 + d)**inv[b - (1 + a)**inv[c]**(1 + d)]**(1 + a)**inv[c])**d - 
    b**inv[b - (1 + a)**inv[c]**(1 + d)]**(1 + a)**inv[c] + inv[c]**(1 + d)**inv[b - 
    (1 + a)**inv[c]**(1 + d)]** b}, 
 {d**inv[b - (1 + a)**inv[c]**(1 + d)] - (1 + d)**inv[b - (1 + a)**inv[c]**(1 + d)] - 
    inv[b - (1 + a)**inv[c]**(1 + d)]**a + inv[b - (1 + a)**inv[c]**(1 + d)]**(1 + a), 
  1 - inv[b - (1 + a)**inv[c]**(1 + d)]**b - d**inv[b - (1 + a)**inv[c]**(1 + d)]**(1 + 
    a)**inv[c] + (1 + d)**inv[b - (1 + a)**inv[c]**(1 + d)]**(1 + a)**inv[c] + 
    inv[b - (1 + a)**inv[c]**(1 + d)]**(1 + a)**inv[c]**d}}", "Output"],
Cell[TextData[{"and,", " ", "finally,"}], "Text"],
Cell["NCMatrixExpand[m3] // NCSimplifyRational    ", "Input"],
Cell[TextData[{"returns"}], "Text"],
Cell["{{0, 0}, {0, 0}}", "Output"],
Cell[TextData[{"as", " ", "expected."}], "Text"],
Cell[TextData[{"Trouble", " ", "with", " ", Cell[BoxData[FormBox[RowBox[{"Plus"}], TraditionalForm]]], " ", "(", Cell[BoxData[FormBox[RowBox[{"+"}], TraditionalForm]]], ")", " ", "and", " ", "matrices"}], "Subsubsection"],
Cell[TextData[{"Mathematica's", " ", "choice", " ", "of", " ", "treating", " ", "lists", " ", "and", " ", "matrix", " ", "indistinctively", " ", "can", " ", "cause", " ", "much", " ", "trouble", " ", "when", " ", "mixing", " ", Cell[BoxData[FormBox[RowBox[{"**"}], TraditionalForm]]], " ", "with", " ", Cell[BoxData[FormBox[RowBox[{"Plus"}], TraditionalForm]]], " ", "(", Cell[BoxData[FormBox[RowBox[{"+"}], TraditionalForm]]], ")", " ", "operator.", " ", "The", " ", "reason", " ", "for", " ", "that", " ", "is", " ", "that", " ", Cell[BoxData[FormBox[RowBox[{"Plus"}], TraditionalForm]]], " ", "is", " ", Cell[BoxData[FormBox[RowBox[{"Listable"}], TraditionalForm]]], ",", " ", "and", " ", "an", " ", "expression", " ", "like"}], "Text"],
Cell["z + m1", "Input"],
Cell[TextData[{"where", " ", Cell[BoxData[FormBox[RowBox[{"m1"}], TraditionalForm]]], " ", "is", " ", "an", " ", "array", " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"z"}], TraditionalForm]]], " ", "is", " ", "not,", " ", "is", " ", "automatically", " ", "expanded", " ", "into"}], "Text"],
Cell["{{a + z, b + z}, {c + z, d + z}}", "Output"],
Cell[TextData[{"or,", " ", "using", " ", Cell[BoxData[FormBox[RowBox[{"MatrixForm"}], TraditionalForm]]], ":"}], "Text"],
Cell["z + m1 // MatrixForm", "Input"],
Cell[TextData[{"resulting", " ", "in"}], "Text"],
Cell[TextData[{Cell[ToExpression["\\begin{bmatrix} a + z & b + z \\\\ c + z & d + z \\end{bmatrix}", TeXForm]]}], "Text"],
Cell[TextData[{"Because", " ", "of", " ", "this", " ", "\"", Cell[TextData[{"feature"}], "Text"], "\"", ",", " ", "the", " ", "expression"}], "Text"],
Cell["m1**m2 + m2 // NCMatrixExpand", "Input"],
Cell[TextData[{"evaluates", " ", "to", " ", "the", " ", "\"", Cell[TextData[{"wrong"}], "Text"], "\"", " ", "result"}], "Text"],
Cell["{{{{d + a**d + b**e, 2 a + 3 b + d}, {d + c**d + d**e, 2 c + 4 d}},
 {{2 + a**d + b**e, 2 + 2 a + 3 b}, {2 + c**d + d**e, 2 + 2 c + 3 d}}}, 
 {{{e + a**d + b**e, 2 a + 3 b + e}, {e + c**d + d**e, 2 c + 3 d + e}}, 
 {{3 + a**d + b**e, 3 + 2 a + 3 b}, {3 + c**d + d**e, 3 + 2 c + 3 d}}}}", "Output"],
Cell[TextData[{"which", " ", "is", " ", "different", " ", "than", " ", "the", " ", "\"", Cell[TextData[{"correct"}], "Text"], "\"", " ", "result"}], "Text"],
Cell["{{d + a**d + b**e, 2 + 2 a + 3 b}, 
 {e + c**d + d**e, 3 + 2 c + 3 d}}", "Output"],
Cell[TextData[{"which", " ", "is", " ", "returned", " ", "by", " ", "either"}], "Text"],
Cell["NCMatrixExpand[m1**m2] + m2", "Input"],
Cell[TextData[{"or"}], "Text"],
Cell["NCDot[m1, m2] + m2", "Input"],
Cell[TextData[{"The", " ", "reason", " ", "for", " ", "the", " ", "behavior", " ", "is", " ", "that", " ", Cell[BoxData[FormBox[RowBox[{"m1**m2"}], TraditionalForm]]], " ", "is", " ", "essentially", " ", "treated", " ", "as", " ", "a", " ", StyleBox[Cell[TextData[{Cell[TextData[{"scalar"}], "Text"]}]], FontSlant->"Italic"], " ", "(it", " ", "does", " ", "not", " ", "have", " ", StyleBox[Cell[TextData[{Cell[TextData[{"head"}], "Text"]}]], FontSlant->"Italic"], " ", Cell[BoxData[FormBox[RowBox[{"List"}], TraditionalForm]]], ")", " ", "and", " ", "therefore", " ", "gets", " ", "added", " ", "entrywise", " ", "to", " ", Cell[BoxData[FormBox[RowBox[{"m2"}], TraditionalForm]]], " ", StyleBox[Cell[TextData[{Cell[TextData[{"before"}], "Text"]}]], FontSlant->"Italic"], " ", Cell[BoxData[FormBox[RowBox[{"NCMatrixExpand"}], TraditionalForm]]], " ", "has", " ", "a", " ", "chance", " ", "to", " ", "evaluate", " ", "the", " ", Cell[BoxData[FormBox[RowBox[{"**"}], TraditionalForm]]], " ", "product."}], "Text"],
Cell[TextData[{"There", " ", "are", " ", "no", " ", "easy", " ", "fixes", " ", "for", " ", "this", " ", "problem,", " ", "which", " ", "affects", " ", "not", " ", "only", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "but", " ", "any", " ", "similar", " ", "type", " ", "of", " ", "matrix", " ", "product", " ", "evaluation", " ", "in", " ", "Mathematica.", " ", "With", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], ",", " ", "a", " ", "better", " ", "option", " ", "is", " ", "to", " ", "use", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"NCMatrixReplaceAll"}], TraditionalForm]]]}], "Text"]}]], FontSlant->"Italic"], "NCMatrixReplaceAll"]], " ", "or", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"NCMatrixReplaceRepeated"}], TraditionalForm]]]}], "Text"]}]], FontSlant->"Italic"], "NCMatrixReplaceRepeated"]], ".", " ", "As", " ", "seen", " ", "in", " ", "the", " ", "section", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{"Replace", " ", "with", " ", "matrices"}], "Text"]}]], FontSlant->"Italic"], "ReplaceWithMatrices"]], ",", " ", "the", " ", "command"}], "Text"],
Cell["NCMatrixReplaceAll[x**y + y, {x -> m1, y -> m2}]", "Input"],
Cell[TextData[{"produces", " ", "the", " ", "expected", " ", "result:"}], "Text"],
Cell["{{d + a**d + b**e, 2 + 2 a + 3 b}, 
 {e + c**d + d**e, 3 + 2 c + 3 d}}", "Output"],
Cell[TextData[{"Note", " ", "that", " ", "the", " ", "above", " ", "behavior", " ", "might", " ", "be", " ", "erratic,", " ", "since", " ", "in", " ", "an", " ", "expression", " ", "like"}], "Text"],
Cell["m1**m2 + m2**m1", "Input"],
Cell[TextData[{"in", " ", "which", " ", Cell[BoxData[FormBox[RowBox[{"**"}], TraditionalForm]]], " ", "is", " ", "kept", " ", "unevaluated", " ", "as", " ", "in"}], "Text"],
Cell["{{a, b}, {c, d}}**{{d, 2}, {e, 3}} + {{d, 2}, {e, 3}}**{{a, b}, {c, d}}", "Output"],
Cell[TextData[{"the", " ", "command"}], "Text"],
Cell["m1**m2 + m2**m1 // NCMatrixExpand", "Input"],
Cell[TextData[{"expands", " ", "to", " ", "the", " ", "expected", " ", "result"}], "Text"],
Cell["{{2 c + a**d + b**e + d**a, 2 a + 3 b + 2 d + d**b}, 
 {3 c + c**d + d**e + e**a, 2 c + 6 d + e**b}}", "Output"],
Cell[TextData[{"Polynomials", " ", "with", " ", "commutative", " ", "coefficients"}], "Subsection"],
Cell[TextData[{"The", " ", "package", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]]}], "Text"]}]], FontSlant->"Italic"], "PackageNCPoly"]], " ", "provides", " ", "an", " ", "efficient", " ", "structure", " ", "for", " ", "storing", " ", "and", " ", "operating", " ", "with", " ", "noncommutative", " ", "polynomials", " ", "with", " ", "commutative", " ", "coefficients.", " ", "There", " ", "are", " ", "two", " ", "main", " ", "goals:"}], "Text"],
Cell[TextData[{Cell[TextData[{StyleBox[Cell[TextData[{Cell[TextData[{"Ordering"}], "Text"]}]], FontSlant->"Italic"], ":", " ", "to", " ", "be", " ", "able", " ", "to", " ", "sort", " ", "polynomials", " ", "based", " ", "on", " ", "an", " ", StyleBox[Cell[TextData[{Cell[TextData[{"ordering"}], "Text"]}]], FontSlant->"Italic"], " ", "specified", " ", "by", " ", "the", " ", "user.", " ", "See", " ", "the", " ", "chapter", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{"Noncommutative", " ", "Gr\[ODoubleDot]bner", " ", "Basis"}], "Text"]}]], FontSlant->"Italic"], "NCGB"]], " ", "for", " ", "more", " ", "details."}], "Text"]}], "ItemNumbered"],
Cell[TextData[{Cell[TextData[{StyleBox[Cell[TextData[{Cell[TextData[{"Efficiency"}], "Text"]}]], FontSlant->"Italic"], ":", " ", "to", " ", "efficiently", " ", "perform", " ", "polynomial", " ", "algebra", " ", "with", " ", "as", " ", "little", " ", "overhead", " ", "as", " ", "possible."}], "Text"]}], "ItemNumbered"],
Cell[TextData[{"Those", " ", "two", " ", "properties", " ", "allow", " ", "for", " ", "an", " ", "efficient", " ", "implementation", " ", "of", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], "'s", " ", "noncommutative", " ", "Gr\[ODoubleDot]bner", " ", "basis", " ", "algorithm,", " ", "new", " ", "in", " ", StyleBox[Cell[TextData[{Cell[TextData[{"Version", " ", "5"}], "Text"]}]], FontWeight->"Bold"], ",", " ", "without", " ", "the", " ", "use", " ", "of", " ", "auxiliary", " ", "accelerating", " ", Cell[BoxData[FormBox[RowBox[{"C"}], TraditionalForm]]], " ", "code,", " ", "as", " ", "in", " ", Cell[BoxData[FormBox[RowBox[{"NCGB"}], TraditionalForm]]], ".", " ", "See", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{"Noncommutative", " ", "Gr\[ODoubleDot]bner", " ", "Basis"}], "Text"]}]], FontSlant->"Italic"], "NCGB"]], "."}], "Text"],
Cell[TextData[{"Before", " ", "getting", " ", "into", " ", "details,", " ", "to", " ", "see", " ", "how", " ", "much", " ", "more", " ", "efficient", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], " ", "is", " ", "when", " ", "compared", " ", "with", " ", "standard", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "objects", " ", "try"}], "Text"],
Cell["Table[Timing[NCExpand[(1 + x)^i]][[1]], {i, 0, 15, 5}]", "Input"],
Cell[TextData[{"which", " ", "would", " ", "typically", " ", "return", " ", "something", " ", "like"}], "Text"],
Cell["{0.000088, 0.001074, 0.017322, 0.240704, 3.61492}", "Output"],
Cell[TextData[{"whereas", " ", "the", " ", "equivalent"}], "Text"],
Cell["<< NCPoly`
Table[Timing[(1 + NCPolyMonomial[{x}, {x}])^i][[1]], {i, 0, 15, 5}]", "Input"],
Cell[TextData[{"would", " ", "return"}], "Text"],
Cell["{0.00097, 0.001653, 0.002208, 0.003908, 0.004306}", "Output"],
Cell[TextData[{"The", " ", "best", " ", "way", " ", "to", " ", "work", " ", "with", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], " ", "in", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "is", " ", "by", " ", "loading", " ", "the", " ", "package", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"NCPolyInterface"}], TraditionalForm]]]}], "Text"]}]], FontSlant->"Italic"], "PackageNCPolyInterface"]], ":"}], "Text"],
Cell["<< NCPolyInterface`", "Input"],
Cell[TextData[{"which", " ", "provides", " ", "the", " ", "commands", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"NCToNCPoly"}], TraditionalForm]]]}], "Text"]}]], FontSlant->"Italic"], "NCToNCPoly"]], " ", "and", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"NCPolyToNC"}], TraditionalForm]]]}], "Text"]}]], FontSlant->"Italic"], "NCPolyToNC"]], " ", "to", " ", "convert", " ", "nc", " ", "expressions", " ", "back", " ", "and", " ", "forth", " ", "between", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], "."}], "Text"],
Cell[TextData[{"For", " ", "example"}], "Text"],
Cell["vars = {x, y, z};
p = NCToNCPoly[1 + x**x - 2 x**y**z, vars]", "Input"],
Cell[TextData[{"converts", " ", "the", " ", "polynomial", " ", Cell[BoxData[FormBox[RowBox[{"1 + x**x - 2 x**y**z"}], TraditionalForm]]], " ", "from", " ", "the", " ", "standard", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "format", " ", "into", " ", "an", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], " ", "object.", " ", "The", " ", "reason", " ", "for", " ", "the", " ", "braces", " ", "in", " ", "the", " ", "definition", " ", "of", " ", Cell[BoxData[FormBox[RowBox[{"vars"}], TraditionalForm]]], " ", "will", " ", "be", " ", "explained", " ", "below,", " ", "when", " ", "we", " ", "introduce", " ", StyleBox[Cell[TextData[{Cell[TextData[{"ordering"}], "Text"]}]], FontSlant->"Italic"], ".", " ", "See", " ", "also", " ", "Section", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{"Noncommutative", " ", "Gr\[ODoubleDot]bner", " ", "Basis"}], "Text"]}]], FontSlant->"Italic"], "NCGB"]], ".", " ", "The", " ", "result", " ", "in", " ", "this", " ", "case", " ", "is", " ", "the", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], " ", "object"}], "Text"],
Cell["NCPoly[{1, 1, 1}, <|{0, 0, 0, 0} -> 1, {0, 0, 2, 0} -> 1, {1, 1, 1, 5} -> -2|>]", "Output"],
Cell[TextData[{"Conversely", " ", "the", " ", "command", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"NCPolyToNC"}], TraditionalForm]]]}], "Text"]}]], FontSlant->"Italic"], "NCPolyToNC"]], " ", "converts", " ", "an", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], " ", "back", " ", "into", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "format.", " ", "For", " ", "example"}], "Text"],
Cell["NCPolyToNC[p, vars]", "Input"],
Cell[TextData[{"returns"}], "Text"],
Cell["1 + x^2 - 2 x**y**z", "Output"],
Cell[TextData[{"as", " ", "expected.", " ", "Note", " ", "that", " ", "an", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], " ", "object", " ", "does", " ", "not", " ", "store", " ", "symbols,", " ", "but", " ", "rather", " ", "a", " ", "representation", " ", "of", " ", "the", " ", "polynomial", " ", "based", " ", "on", " ", "specially", " ", "encoded", " ", "monomials.", " ", "This", " ", "is", " ", "the", " ", "reason", " ", "why", " ", "one", " ", "should", " ", "provide", " ", Cell[BoxData[FormBox[RowBox[{"vars"}], TraditionalForm]]], " ", "as", " ", "an", " ", "argument", " ", "to", " ", Cell[BoxData[FormBox[RowBox[{"NCPolyToNC"}], TraditionalForm]]], "."}], "Text"],
Cell[TextData[{"Alternatively,", " ", "one", " ", "could", " ", "construct", " ", "the", " ", "same", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], " ", "object", " ", "by", " ", "calling", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], " ", "directly", " ", "as", " ", "in"}], "Text"],
Cell["NCPoly[{1, 1, -2}, {{}, {x, x}, {x, y, z}}, vars]", "Input"],
Cell[TextData[{"In", " ", "this", " ", "syntax", " ", "the", " ", "first", " ", "argument", " ", "is", " ", "a", " ", "list", " ", "of", " ", StyleBox[Cell[TextData[{Cell[TextData[{"coefficients"}], "Text"]}]], FontSlant->"Italic"], ",", " ", "the", " ", "second", " ", "argument", " ", "is", " ", "a", " ", "list", " ", "of", " ", StyleBox[Cell[TextData[{Cell[TextData[{"monomials"}], "Text"]}]], FontSlant->"Italic"], ",", " ", "and", " ", "the", " ", "third", " ", "is", " ", "the", " ", "list", " ", "of", " ", StyleBox[Cell[TextData[{Cell[TextData[{"variables"}], "Text"]}]], FontSlant->"Italic"], ".", " ", StyleBox[Cell[TextData[{Cell[TextData[{"Monomials"}], "Text"]}]], FontSlant->"Italic"], " ", "are", " ", "given", " ", "as", " ", "lists,", " ", "with", " ", Cell[BoxData[FormBox[RowBox[{"{}"}], TraditionalForm]]], " ", "being", " ", "equivalent", " ", "to", " ", "a", " ", "constant", " ", Cell[BoxData[FormBox[RowBox[{"1"}], TraditionalForm]]], "."}], "Text"],
Cell[TextData[{"The", " ", "particular", " ", "coefficients", " ", "in", " ", "the", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], " ", "object", " ", "depend", " ", "not", " ", "only", " ", "on", " ", "the", " ", "polynomial", " ", "being", " ", "represented", " ", "but", " ", "also", " ", "on", " ", "the", " ", StyleBox[Cell[TextData[{Cell[TextData[{"ordering"}], "Text"]}]], FontSlant->"Italic"], " ", "implied", " ", "by", " ", "the", " ", "sequence", " ", "of", " ", "symbols", " ", "in", " ", "the", " ", "list", " ", "of", " ", "variables", " ", Cell[BoxData[FormBox[RowBox[{"vars"}], TraditionalForm]]], ".", " ", "For", " ", "example:"}], "Text"],
Cell["vars = {{x}, {y, z}};
p = NCToNCPoly[1 + x**x - 2 x**y**z, vars]", "Input"],
Cell[TextData[{"produces:"}], "Text"],
Cell["NCPoly[{1, 2}, <|{0, 0, 0} -> 1, {0, 2, 0} -> 1, {2, 1, 5} -> -2|>", "Output"],
Cell[TextData[{"The", " ", "sequence", " ", "of", " ", "braces", " ", "in", " ", "the", " ", "list", " ", "of", " ", StyleBox[Cell[TextData[{Cell[TextData[{"variables"}], "Text"]}]], FontSlant->"Italic"], " ", "encodes", " ", "the", " ", StyleBox[Cell[TextData[{Cell[TextData[{"ordering"}], "Text"]}]], FontSlant->"Italic"], " ", "to", " ", "be", " ", "used", " ", "for", " ", "sorting", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], "s.", " ", "Orderings", " ", "specify", " ", "how", " ", "monomials", " ", "should", " ", "be", " ", "ordered,", " ", "and", " ", "is", " ", "discussed", " ", "in", " ", "detail", " ", "in", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{"Noncommutative", " ", "Gr\[ODoubleDot]bner", " ", "Basis"}], "Text"]}]], FontSlant->"Italic"], "NCGB"]], ".", " ", "We", " ", "provide", " ", "the", " ", "convenience", " ", "command", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"NCPolyDisplayOrder"}], TraditionalForm]]]}], "Text"]}]], FontSlant->"Italic"], "NCPolyDisplayOrder"]], " ", "that", " ", "prints", " ", "the", " ", "polynomial", " ", "ordering", " ", "implied", " ", "by", " ", "a", " ", "list", " ", "of", " ", "symbols.", " ", "For", " ", "example"}], "Text"],
Cell["NCPolyDisplayOrder[{x,y,z}]", "Input"],
Cell[TextData[{"prints", " ", "out"}], "Text"],
Cell[TextData[{Cell[ToExpression["x \\ll y \\ll z", TeXForm]]}], "Text"],
Cell[TextData[{"and"}], "Text"],
Cell["NCPolyDisplayOrder[{{x},{y,z}}]", "Input"],
Cell[TextData[{"prints", " ", "out"}], "Text"],
Cell[TextData[{Cell[ToExpression["x \\ll y < z", TeXForm]]}], "Text"],
Cell[TextData[{"from", " ", "where", " ", "you", " ", "can", " ", "see", " ", "that", " ", "grouping", " ", "variables", " ", "inside", " ", "braces", " ", "induces", " ", "a", " ", "graded", " ", "type", " ", "ordering,", " ", "as", " ", "discussed", " ", "in", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{"Noncommutative", " ", "Gr\[ODoubleDot]bner", " ", "Basis"}], "Text"]}]], FontSlant->"Italic"], "NCGB"]], ".", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], "s", " ", "constructed", " ", "from", " ", "different", " ", "orderings", " ", "cannot", " ", "be", " ", "combined."}], "Text"],
Cell[TextData[{"There", " ", "is", " ", "also", " ", "a", " ", "special", " ", "constructor", " ", "for", " ", "monomials.", " ", "For", " ", "example"}], "Text"],
Cell["NCPolyMonomial[{y,x}, vars]
NCPolyMonomial[{x,y}, vars]", "Input"],
Cell[TextData[{"return", " ", "the", " ", "monomials", " ", "corresponding", " ", "to", " ", Cell[ToExpression["y x", TeXForm]], " ", "and", " ", Cell[ToExpression["x y", TeXForm]], "."}], "Text"],
Cell[TextData[{"Operations", " ", "on", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], " ", "objects", " ", "result", " ", "in", " ", "another", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], " ", "object", " ", "that", " ", "is", " ", "always", " ", "expanded.", " ", "For", " ", "example:"}], "Text"],
Cell["vars = {{x}, {y, z}};
1 + NCPolyMonomial[{x, y}, vars] - 2 NCPolyMonomial[{y, x}, vars]", "Input"],
Cell[TextData[{"returns"}], "Text"],
Cell["NCPoly[{1, 2}, <|{0, 0, 0} -> 1, {1, 1, 1} -> 1, {1, 1, 3} -> -2|>]", "Output"],
Cell[TextData[{"and"}], "Text"],
Cell["p = (1 + NCPolyMonomial[{x}, vars]**NCPolyMonomial[{y}, vars])^2", "Input"],
Cell[TextData[{"returns"}], "Text"],
Cell["NCPoly[{1, 2}, <|{0, 0, 0} -> 1, {1, 1, 1} -> 2, {2, 2, 10} -> 1|>]", "Output"],
Cell[TextData[{"Another", " ", "convenience", " ", "function", " ", "is", " ", Cell[BoxData[FormBox[RowBox[{"NCPolyDisplay"}], TraditionalForm]]], " ", "which", " ", "returns", " ", "a", " ", "list", " ", "with", " ", "the", " ", "monomials", " ", "appearing", " ", "in", " ", "an", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], " ", "object.", " ", "For", " ", "example:"}], "Text"],
Cell["NCPolyDisplay[p, vars]", "Input"],
Cell[TextData[{"returns"}], "Text"],
Cell["{x.y.x.y, 2 x.y, 1}", "Output"],
Cell[TextData[{"The", " ", "reason", " ", "for", " ", "displaying", " ", "an", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], " ", "object", " ", "as", " ", "a", " ", "list", " ", "is", " ", "so", " ", "that", " ", "the", " ", "monomials", " ", "can", " ", "appear", " ", "in", " ", "the", " ", "same", " ", "order", " ", "as", " ", "they", " ", "are", " ", "stored.", " ", "Using", " ", Cell[BoxData[FormBox[RowBox[{"Plus"}], TraditionalForm]]], " ", "would", " ", "revert", " ", "to", " ", "Mathematica's", " ", "default", " ", "ordering.", " ", "For", " ", "example"}], "Text"],
Cell["p = NCToNCPoly[1 + x**y**x - 2 x**x + z, vars]
NCPolyDisplay[p, vars]", "Input"],
Cell[TextData[{"returns"}], "Text"],
Cell["{x.y.x, z, -2 x.x, 1}", "Output"],
Cell[TextData[{"whereas"}], "Text"],
Cell["NCPolyToNC[p, vars]", "Input"],
Cell[TextData[{"would", " ", "return"}], "Text"],
Cell["1 - 2 x^2 + z + x**y**x", "Output"],
Cell[TextData[{"in", " ", "which", " ", "the", " ", "sorting", " ", "of", " ", "the", " ", "monomials", " ", "has", " ", "been", " ", "destroyed", " ", "by", " ", Cell[BoxData[FormBox[RowBox[{"Plus"}], TraditionalForm]]], "."}], "Text"],
Cell[TextData[{"The", " ", "monomials", " ", "appear", " ", "sorted", " ", "in", " ", "decreasing", " ", "order", " ", "from", " ", "left", " ", "to", " ", "right,", " ", "with", " ", Cell[BoxData[FormBox[RowBox[{"z"}], TraditionalForm]]], " ", "being", " ", "the", " ", StyleBox[Cell[TextData[{Cell[TextData[{"leading", " ", "term"}], "Text"]}]], FontSlant->"Italic"], " ", "in", " ", "the", " ", "above", " ", "example."}], "Text"],
Cell[TextData[{"With", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], " ", "the", " ", "Mathematica", " ", "command", " ", Cell[BoxData[FormBox[RowBox[{"Sort"}], TraditionalForm]]], " ", "is", " ", "modified", " ", "to", " ", "sort", " ", "lists", " ", "of", " ", "polynomials.", " ", "For", " ", "example"}], "Text"],
Cell["polys = NCToNCPoly[{x**x**x, 2 y**x - z, z, y**x - x**x}, vars];
ColumnForm[NCPolyDisplay[Sort[polys], vars]]", "Input"],
Cell[TextData[{"returns"}], "Text"],
Cell["{x.x.x}
{z}
{y.x, -x.x}
{2 y.x, -z}", "Output"],
Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"Sort"}], TraditionalForm]]], " ", "produces", " ", "a", " ", "list", " ", "of", " ", "polynomials", " ", "sorted", " ", "in", " ", StyleBox[Cell[TextData[{Cell[TextData[{"ascending"}], "Text"]}]], FontSlant->"Italic"], " ", "order", " ", "based", " ", "on", " ", "their", " ", StyleBox[Cell[TextData[{Cell[TextData[{"leading", " ", "terms"}], "Text"]}]], FontSlant->"Italic"], "."}], "Text"],
Cell[TextData[{"Polynomials", " ", "with", " ", "noncommutative", " ", "coefficients"}], "Subsection"],
Cell[TextData[{"A", " ", "larger", " ", "class", " ", "of", " ", "polynomials", " ", "in", " ", "noncommutative", " ", "variables", " ", "is", " ", "that", " ", "of", " ", "polynomials", " ", "with", " ", "noncommutative", " ", "coefficients.", " ", "Think", " ", "of", " ", "a", " ", "polynomial", " ", "with", " ", "commutative", " ", "coefficients", " ", "in", " ", "which", " ", "certain", " ", "variables", " ", "are", " ", "considered", " ", "to", " ", "be", " ", "unknown,", " ", "i.e. ", StyleBox[Cell[TextData[{Cell[TextData[{"variables"}], "Text"]}]], FontSlant->"Italic"], ",", " ", "where", " ", "others", " ", "are", " ", "considered", " ", "to", " ", "be", " ", "known,", " ", "i.e. ", StyleBox[Cell[TextData[{Cell[TextData[{"coefficients"}], "Text"]}]], FontSlant->"Italic"], ".", " ", "For", " ", "example,", " ", "in", " ", "many", " ", "problems", " ", "in", " ", "systems", " ", "and", " ", "control", " ", "the", " ", "following", " ", "expression"}], "Text"],
Cell[TextData[{Cell[ToExpression["p(x) = a x + x a^T - x b x + c", TeXForm]]}], "Text"],
Cell[TextData[{"is", " ", "often", " ", "seen", " ", "as", " ", "a", " ", "polynomial", " ", "in", " ", "the", " ", "noncommutative", " ", "unknown", " ", Cell[BoxData[FormBox[RowBox[{"x"}], TraditionalForm]]], " ", "with", " ", "known", " ", "noncommutative", " ", "coefficients", " ", Cell[BoxData[FormBox[RowBox[{"a"}], TraditionalForm]]], ",", " ", Cell[BoxData[FormBox[RowBox[{"b"}], TraditionalForm]]], ",", " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"c"}], TraditionalForm]]], ".", " ", "A", " ", "typical", " ", "problem", " ", "is", " ", "the", " ", "determination", " ", "of", " ", "a", " ", "solution", " ", "to", " ", "the", " ", "equation", " ", Cell[ToExpression["p(x) = 0", TeXForm]], " ", "or", " ", "the", " ", "inequality", " ", Cell[ToExpression["p(x) \\succeq 0", TeXForm]], "."}], "Text"],
Cell[TextData[{"The", " ", "package", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"NCPolynomial"}], TraditionalForm]]]}], "Text"]}]], FontSlant->"Italic"], "PackageNCPolynomial"]], " ", "handles", " ", "such", " ", "polynomials", " ", "with", " ", "noncommutative", " ", "coefficients.", " ", "As", " ", "with", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]]}], "Text"]}]], FontSlant->"Italic"], "PackageNCPoly"]], ",", " ", "the", " ", "package", " ", "provides", " ", "the", " ", "commands", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"NCToNCPolynomial"}], TraditionalForm]]]}], "Text"]}]], FontSlant->"Italic"], "NCToNCPolynomial"]], " ", "and", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"NCPolynomialToNC"}], TraditionalForm]]]}], "Text"]}]], FontSlant->"Italic"], "NCPolynomialToNC"]], " ", "to", " ", "convert", " ", "nc", " ", "expressions", " ", "back", " ", "and", " ", "forth", " ", "between", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"NCPolynomial"}], TraditionalForm]]], ".", " ", "For", " ", "example"}], "Text"],
Cell["vars = {x}
p = NCToNCPolynomial[a**x + x**tp[a] - x**b**x + c, vars]", "Input"],
Cell[TextData[{"converts", " ", "the", " ", "polynomial", " ", Cell[BoxData[FormBox[RowBox[{"a**x + x**tp[a] - x**b**x + c"}], TraditionalForm]]], " ", "from", " ", "the", " ", "standard", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "format", " ", "into", " ", "an", " ", Cell[BoxData[FormBox[RowBox[{"NCPolynomial"}], TraditionalForm]]], " ", "object.", " ", "The", " ", "result", " ", "in", " ", "this", " ", "case", " ", "is", " ", "the", " ", Cell[BoxData[FormBox[RowBox[{"NCPolynomial"}], TraditionalForm]]], " ", "object"}], "Text"],
Cell["NCPolynomial[c, <|{x} -> {{1, a, 1}, {1, 1, tp[a]}}, {x, x} -> {{-1, 1, b, 1}}|>, {x}]", "Output"],
Cell[TextData[{"Conversely", " ", "the", " ", "command", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"NCPolynomialToNC"}], TraditionalForm]]]}], "Text"]}]], FontSlant->"Italic"], "NCPolynomialToNC"]], " ", "converts", " ", "an", " ", Cell[BoxData[FormBox[RowBox[{"NCPolynomial"}], TraditionalForm]]], " ", "back", " ", "into", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "format.", " ", "For", " ", "example"}], "Text"],
Cell["NCPolynomialToNC[p]", "Input"],
Cell[TextData[{"returns"}], "Text"],
Cell["c + a**x + x**tp[a] - x**b**x", "Output"],
Cell[TextData[{"An", " ", Cell[BoxData[FormBox[RowBox[{"NCPolynomial"}], TraditionalForm]]], " ", "does", " ", "store", " ", "information", " ", "about", " ", "the", " ", "polynomial", " ", "symbols", " ", "and", " ", "a", " ", "list", " ", "of", " ", "variables", " ", "is", " ", "required", " ", "only", " ", "at", " ", "the", " ", "time", " ", "of", " ", "creation", " ", "of", " ", "the", " ", Cell[BoxData[FormBox[RowBox[{"NCPolynomial"}], TraditionalForm]]], " ", "object."}], "Text"],
Cell[TextData[{"As", " ", "with", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], ",", " ", "operations", " ", "on", " ", Cell[BoxData[FormBox[RowBox[{"NCPolynomial"}], TraditionalForm]]], " ", "objects", " ", "result", " ", "on", " ", "another", " ", Cell[BoxData[FormBox[RowBox[{"NCPolynomial"}], TraditionalForm]]], " ", "object", " ", "that", " ", "is", " ", "always", " ", "expanded.", " ", "For", " ", "example:"}], "Text"],
Cell["vars = {x,y}
1 + NCToNCPolynomial[x**y, vars] - 2 NCToNCPolynomial[y**x, vars]", "Input"],
Cell[TextData[{"returns"}], "Text"],
Cell["NCPolynomial[1, <|{y**x} -> {{-2, 1, 1}}, {x**y} -> {{1, 1, 1}}|>, {x, y}]", "Output"],
Cell[TextData[{"and"}], "Text"],
Cell["(1 + NCToNCPolynomial[x, vars]**NCToNCPolynomial[y, vars])^2", "Input"],
Cell[TextData[{"returns"}], "Text"],
Cell["NCPolynomial[1, <|{x**y**x**y} -> {{1, 1, 1}}, {x**y} -> {{2, 1, 1}}|>, {x, y}]", "Output"],
Cell[TextData[{"To", " ", "see", " ", "how", " ", "much", " ", "more", " ", "efficient", " ", Cell[BoxData[FormBox[RowBox[{"NCPolynomial"}], TraditionalForm]]], " ", "is", " ", "when", " ", "compared", " ", "with", " ", "standard", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "objects", " ", "try"}], "Text"],
Cell["Table[Timing[(NCToNCPolynomial[x, vars])^i][[1]], {i, 0, 15, 5}]", "Input"],
Cell[TextData[{"would", " ", "return"}], "Text"],
Cell["{0.000493, 0.003345, 0.005974, 0.013479, 0.018575}", "Output"],
Cell[TextData[{"As", " ", "you", " ", "can", " ", "see,", " ", Cell[BoxData[FormBox[RowBox[{"NCPolynomial"}], TraditionalForm]]], "s", " ", "are", " ", "not", " ", "as", " ", "efficient", " ", "as", " ", Cell[BoxData[FormBox[RowBox[{"NCPoly"}], TraditionalForm]]], "s", " ", "but", " ", "still", " ", "much", " ", "more", " ", "efficient", " ", "than", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "polynomials."}], "Text"],
Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"NCPolynomials"}], TraditionalForm]]], " ", "do", " ", "not", " ", "support", " ", StyleBox[Cell[TextData[{Cell[TextData[{"orderings"}], "Text"]}]], FontSlant->"Italic"], " ", "but", " ", "we", " ", "do", " ", "provide", " ", "the", " ", Cell[BoxData[FormBox[RowBox[{"NCPSort"}], TraditionalForm]]], " ", "command", " ", "that", " ", "produces", " ", "a", " ", "list", " ", "of", " ", "terms", " ", "sorted", " ", "by", " ", "degree.", " ", "For", " ", "example"}], "Text"],
Cell["NCPSort[p]", "Input"],
Cell[TextData[{"returns"}], "Text"],
Cell["{c, a**x, x**tp[a], -x**b**x}", "Output"],
Cell[TextData[{"A", " ", "useful", " ", "feature", " ", "of", " ", Cell[BoxData[FormBox[RowBox[{"NCPolynomial"}], TraditionalForm]]], " ", "is", " ", "the", " ", "capability", " ", "of", " ", "handling", " ", "polynomial", " ", "matrices.", " ", "For", " ", "example"}], "Text"],
Cell["mat1 = {{a**x + x**tp[a] + c**y + tp[y]**tp[c] - x**q**x, b**x}, 
        {x**tp[b], 1}};
p1 = NCToNCPolynomial[mat1, {x, y}];

mat2 = {{1, x**tp[c]}, {c**x, 1}};
p2 = NCToNCPolynomial[mat2, {x, y}];", "Input"],
Cell[TextData[{"constructs", " ", Cell[BoxData[FormBox[RowBox[{"NCPolynomial"}], TraditionalForm]]], " ", "objects", " ", "representing", " ", "the", " ", "polynomial", " ", "matrices", " ", Cell[BoxData[FormBox[RowBox[{"mat1"}], TraditionalForm]]], " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"mat2"}], TraditionalForm]]], ".", " ", "Verify", " ", "that"}], "Text"],
Cell["NCPolynomialToNC[p1**p2] - NCDot[mat1, mat2] // NCExpand", "Input"],
Cell[TextData[{"is", " ", "zero", " ", "as", " ", "expected.", " ", "Internally", " ", Cell[BoxData[FormBox[RowBox[{"NCPolynomial"}], TraditionalForm]]], " ", "represents", " ", "a", " ", "polynomial", " ", "matrix", " ", "by", " ", "constructing", " ", "matrix", " ", "factors.", " ", "For", " ", "example", " ", "the", " ", "representation", " ", "of", " ", "the", " ", "matrix", " ", Cell[BoxData[FormBox[RowBox[{"mat1"}], TraditionalForm]]], " ", "correspond", " ", "to", " ", "the", " ", "factors", " ", Cell[ToExpression[" 
\\begin{aligned}
\\begin{bmatrix}
    a x + x a^T + c y + y^T c^T - x q x & b x \\\\ 
    x b^T & 1
\\end{bmatrix} 
&=
\\begin{bmatrix} 0 & 0 \\\\ 0 & 1 \\end{bmatrix}
+
\\begin{bmatrix} a \\\\ 0 \\end{bmatrix}
x
\\begin{bmatrix} 1 & 0 \\end{bmatrix}
+
\\begin{bmatrix} 1 \\\\ 0 \\end{bmatrix}
x
\\begin{bmatrix} a^T & 0 \\end{bmatrix}
+
\\begin{bmatrix} -1 \\\\ 0 \\end{bmatrix}
x q x
\\begin{bmatrix} 1 & 0 \\end{bmatrix}
+ \\\\ & \\qquad \\quad
\\begin{bmatrix} b \\\\ 0 \\end{bmatrix}
x
\\begin{bmatrix} 0 & 1 \\end{bmatrix}
+
\\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix}
x
\\begin{bmatrix} b^T & 0 \\end{bmatrix}
+
\\begin{bmatrix} c \\\\ 0 \\end{bmatrix}
y
\\begin{bmatrix} 1 & 0 \\end{bmatrix}
+
\\begin{bmatrix} 1 \\\\ 0 \\end{bmatrix}
y^T
\\begin{bmatrix} c^T & 0 \\end{bmatrix}
\\end{aligned}
", TeXForm]]}], "Text"],
Cell[TextData[{"See", " ", "section", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{"linear", " ", "polynomials"}], "Text"]}]], FontSlant->"Italic"], "Linear"]], " ", "for", " ", "more", " ", "features", " ", "on", " ", "linear", " ", "polynomial", " ", "matrices."}], "Text"],
Cell[TextData[{"Linear", " ", "polynomials"}], "Subsection"],
Cell[TextData[{"Another", " ", "interesting", " ", "class", " ", "of", " ", "nc", " ", "polynomials", " ", "is", " ", "that", " ", "of", " ", "linear", " ", "polynomials,", " ", "which", " ", "can", " ", "be", " ", "factored", " ", "in", " ", "the", " ", "form:"}], "Text"],
Cell[TextData[{Cell[ToExpression["s(x) = l (F \\otimes x) r", TeXForm]]}], "Text"],
Cell[TextData[{"where", " ", Cell[ToExpression["l", TeXForm]], " ", "and", " ", Cell[ToExpression["r", TeXForm]], " ", "are", " ", "vectors", " ", "with", " ", "symbolic", " ", "expressions", " ", "and", " ", Cell[ToExpression["F", TeXForm]], " ", "is", " ", "a", " ", "numeric", " ", "matrix.", " ", "This", " ", "functionality", " ", "is", " ", "in", " ", "the", " ", "package"}], "Text"],
Cell["<< NCSylvester`", "Input"],
Cell[TextData[{"Use", " ", "the", " ", "command", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"NCToNCSylvester"}], TraditionalForm]]]}], "Text"]}]], FontSlant->"Italic"], "NCToNCSylvester"]], " ", "to", " ", "factor", " ", "a", " ", "linear", " ", "nc", " ", "polynomial", " ", "into", " ", "the", " ", "the", " ", "above", " ", "form.", " ", "For", " ", "example:"}], "Text"],
Cell["vars = {x, y};
expr = 1 + a**x + x**tp[a] - x + b**y**d + tp[d]**tp[y]**tp[b];
{const, lin} = NCToNCSylvester[expr, vars];", "Input"],
Cell[TextData[{"which", " ", "returns"}], "Text"],
Cell["const = 1", "Output"],
Cell[TextData[{"and", " ", "an", " ", Cell[BoxData[FormBox[RowBox[{"Association"}], TraditionalForm]]], " ", Cell[BoxData[FormBox[RowBox[{"lin"}], TraditionalForm]]], " ", "containing", " ", "the", " ", "factorization.", " ", "For", " ", "example"}], "Text"],
Cell["lin[x]", "Input"],
Cell[TextData[{"returns", " ", "a", " ", "list", " ", "with", " ", "the", " ", "left", " ", "and", " ", "right", " ", "vectors", " ", Cell[BoxData[FormBox[RowBox[{"l"}], TraditionalForm]]], " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"r"}], TraditionalForm]]], " ", "and", " ", "the", " ", "coefficient", " ", "array", " ", Cell[BoxData[FormBox[RowBox[{"F"}], TraditionalForm]]], "."}], "Text"],
Cell["{{1, a}, {1, a^T}, SparseArray[< 2 >, {2, 2}]}", "Output"],
Cell[TextData[{"which", " ", "in", " ", "this", " ", "case", " ", "is", " ", "the", " ", "matrix:"}], "Text"],
Cell[TextData[{Cell[ToExpression["
\\begin{bmatrix}
    -1 & 1\\\\
    1 & 0
\\end{bmatrix}
", TeXForm]]}], "Text"],
Cell[TextData[{"and"}], "Text"],
Cell["lin[tp[y]]", "Input"],
Cell[TextData[{"returns"}], "Text"],
Cell["{{d^T}, {b^T}, SparseArray[< 1 >, {1, 1}]}", "Output"],
Cell[TextData[{"Note", " ", "that", " ", "transposes", " ", "and", " ", "adjoints", " ", "are", " ", "treated", " ", "as", " ", "independent", " ", "variables."}], "Text"],
Cell[TextData[{"Perhaps", " ", "the", " ", "most", " ", "useful", " ", "consequence", " ", "of", " ", "the", " ", "above", " ", "factorization", " ", "is", " ", "the", " ", "possibility", " ", "of", " ", "producing", " ", "a", " ", "linear", " ", "polynomial", " ", "which", " ", "has", " ", "the", " ", "smallest", " ", "possible", " ", "number", " ", "of", " ", "terms,", " ", "as", " ", "explaining", " ", "in", " ", "detail", " ", "in", " ", Cell[TextData[{"[@oliveira:SSP:2012]"}], "Text"], ".", " ", "This", " ", "is", " ", "done", " ", "automatically", " ", "by", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{Cell[BoxData[FormBox[RowBox[{"NCSylvesterToNC"}], TraditionalForm]]]}], "Text"]}]], FontSlant->"Italic"], "NCSylvesterToNC"]], ".", " ", "For", " ", "example"}], "Text"],
Cell["vars = {x, y};
expr = a**x**c - a**x**d - a**y**c + a**y**d + b**x**c - b**x**d - b**y**c + b**y**d;
{const, lin} = NCToNCSylvester[expr, vars];
NCSylvesterToNC[{const, lin}]", "Input"],
Cell[TextData[{"produces:"}], "Text"],
Cell["(a + b)**x**(c - d) + (a + b)**y**(-c + d)", "Output"],
Cell[TextData[{"This", " ", "factorization", " ", "even", " ", "works", " ", "with", " ", "linear", " ", "matrix", " ", "polynomials,", " ", "and", " ", "is", " ", "used", " ", "by", " ", "the", " ", "our", " ", "semidefinite", " ", "programming", " ", "algorithm", " ", "(see", " ", "Chapter", " ", Cell[Hyperlink[StyleBox[Cell[TextData[{Cell[TextData[{"Semidefinite", " ", "Programming"}], "Text"]}]], FontSlant->"Italic"], "SemidefiniteProgramming"]], ")", " ", "to", " ", "factor", " ", "linear", " ", "matrix", " ", "inequalities", " ", "in", " ", "the", " ", "least", " ", "possible", " ", "number", " ", "of", " ", "terms.", " ", "For", " ", "example:"}], "Text"],
Cell["vars = {x};
expr = {{a**x + x**tp[a], b**x, tp[c]},
        {x**tp[b], -1, tp[d]},
        {c, d, -1}};
{const, lin} = NCToNCSylvester[expr, vars]", "Input"],
Cell[TextData[{"result", " ", "in:"}], "Text"],
Cell["const = SparseArray[< 6 >, {3, 3}]
lin = <|x -> {{1, a, b}, {1, tp[a], tp[b]}, SparseArray[< 4 >, {9, 9}]}|>", "Output"],
Cell[TextData[{"See", " ", Cell[TextData[{"[@oliveira:SSP:2012]"}], "Text"], " ", "for", " ", "details", " ", "on", " ", "the", " ", "structure", " ", "of", " ", "the", " ", "constant", " ", "array", " ", Cell[ToExpression["F", TeXForm]], " ", "in", " ", "this", " ", "case."}], "Text"]
,
Cell["(* [^1]: *)", "Text"],
Cell[TextData[{"The", " ", "reason", " ", "is", " ", "that", " ", "making", " ", "an", " ", "operator", " ", Cell[BoxData[FormBox[RowBox[{"Flat"}], TraditionalForm]]], " ", "is", " ", "a", " ", "convenience", " ", "that", " ", "comes", " ", "with", " ", "a", " ", "price:", " ", "lack", " ", "of", " ", "control", " ", "over", " ", "execution", " ", "and", " ", "evaluation.", " ", "Since", " ", Cell[BoxData[FormBox[RowBox[{"NCAlgebra"}], TraditionalForm]]], " ", "has", " ", "to", " ", "operate", " ", "at", " ", "a", " ", "very", " ", "low", " ", "level", " ", "this", " ", "lack", " ", "of", " ", "control", " ", "over", " ", "evaluation", " ", "is", " ", "fatal.", " ", "Indeed,", " ", "making", " ", Cell[BoxData[FormBox[RowBox[{"NonCommutativeMultiply"}], TraditionalForm]]], " ", "have", " ", "an", " ", "attribute", " ", Cell[BoxData[FormBox[RowBox[{"Flat"}], TraditionalForm]]], " ", "will", " ", "throw", " ", "Mathematica", " ", "into", " ", "infinite", " ", "loops", " ", "in", " ", "seemingly", " ", "trivial", " ", "noncommutative", " ", "expressions.", " ", "Hey,", " ", "email", " ", "us", " ", "if", " ", "you", " ", "find", " ", "a", " ", "way", " ", "around", " ", "that", " ", ":)"}], "Text"]
,
Cell["(* [^2]: *)", "Text"],
Cell[TextData[{"One", " ", "might", " ", "have", " ", "encountered", " ", "this", " ", "difficulty", " ", "when", " ", "trying", " ", "to", " ", "match", " ", "a", " ", "product", " ", "of", " ", "commutative", " ", "variables", " ", "in", " ", "a", " ", "commutative", " ", "monomial", " ", "such", " ", "as", " ", Cell[BoxData[FormBox[RowBox[{"x y^2 /. x y -> z"}], TraditionalForm]]], " ", "which", " ", "fails", " ", "to", " ", "match", " ", Cell[BoxData[FormBox[RowBox[{"x y^2"}], TraditionalForm]]], " ", "even", " ", "though", " ", Cell[BoxData[FormBox[RowBox[{"x y^2"}], TraditionalForm]]], " ", "is", " ", "equal", " ", "to", " ", Cell[BoxData[FormBox[RowBox[{"(x y) y"}], TraditionalForm]]], "."}], "Text"]
,
Cell["(* [^3]: *)", "Text"],
Cell[TextData[{"The", " ", "actual", " ", "rule", " ", "in", " ", "this", " ", "case", " ", "is", " ", "the", " ", "more", " ", "complicated", " ", Cell[BoxData[FormBox[RowBox[{"a^n:_Integer?Positive:1**c**b^m:_Integer?Positive:1 -> a^(n-1)**d**b^(m-1)"}], TraditionalForm]]], " ", "with", " ", "additional", " ", "checks", " ", "that", " ", "prevent", " ", "the", " ", "rule", " ", "from", " ", "working", " ", "with", " ", "negative", " ", "powers."}], "Text"]
,
Cell["(* [^4]: *)", "Text"],
Cell[TextData[{"By", " ", "the", " ", "way,", " ", "I", " ", "find", " ", "that", " ", "behavior", " ", "of", " ", "Mathematica's", " ", Cell[BoxData[FormBox[RowBox[{"Module"}], TraditionalForm]]], " ", "questionable,", " ", "since", " ", "something", " ", "like"}], "Text"],
Cell["F[exp_] := Module[{aa, bb},
  SetNonCommutative[aa, bb];
  aa**bb
]", "Input"],
Cell[TextData[{"would", " ", "not", " ", "fail", " ", "to", " ", "treat", " ", Cell[BoxData[FormBox[RowBox[{"aa"}], TraditionalForm]]], " ", "and", " ", Cell[BoxData[FormBox[RowBox[{"bb"}], TraditionalForm]]], " ", "locally.", " ", "It", " ", "is", " ", "their", " ", "appearance", " ", "in", " ", "a", " ", "rule", " ", "that", " ", "triggers", " ", "the", " ", "mostly", " ", "odd", " ", "behavior."}], "Text"]
,
Cell["(* [^5]: *)", "Text"],
Cell[TextData[{"Formerly", " ", Cell[BoxData[FormBox[RowBox[{"MatMult[m1,m2]"}], TraditionalForm]]], "."}], "Text"]
}]
