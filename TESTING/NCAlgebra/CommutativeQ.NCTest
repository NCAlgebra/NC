Block[
  {k,i,j,
   exp1,exp2,
   pattern1,pattern2,pattern3,pattern4,
   zz,yy,
   x,y,b},

  (* History:  Nov 2015: CommutativeQ test (mauricio) *)

  (* Test SNC *)

  SetNonCommutative[x,y,b];

  Clear[zz,yy];
  SetNonCommutative[zz];

  NCTest[CommutativeQ[zz], False];
  NCTest[CommutativeQ[yy], True];

  Clear[zz,yy];

  NCTest[CommutativeQ[zz], True];
  NCTest[CommutativeQ[yy], True];

  SetNonCommutative[zz];

  NCTest[CommutativeQ[zz], False];
  NCTest[CommutativeQ[yy], True];

  NCTest[CommutativeQ[zz[1]], False];
  NCTest[CommutativeQ[zz[zz]], False];
  NCTest[CommutativeQ[zz[yy]], False];

  NCTest[CommutativeQ[yy[1]], True];
  NCTest[CommutativeQ[yy[yy]], True];
  NCTest[CommutativeQ[yy[zz]], False];

  NCTest[CommutativeQ[yy[1,yy]], True];
  NCTest[CommutativeQ[yy[1,zz]], False];

  Clear[zz,yy];

  (* Test rule *)

  Clear[zz];
  SetNonCommutative[zz];

  pattern1=zz_**b_->b**zz;
  exp1=x**y+x**y**y;
  NCTest[(exp1/.pattern1), y**x+x**y**y];

  zz=2;
  exp1=x**y+x**y**y;
  NCTest[(exp1/.pattern1), 2y+x**y**y];

  exp2=y**x+x**y**y;
  NCTest[(exp2/.pattern1), 2x+x**y**y];

  pattern2=_**b_->b;
  NCTest[(exp1/.pattern2), y+x**y**y];
  NCTest[(exp2/.pattern2), x+x**y**y];

  pattern3=__**b_->b;
  NCTest[(exp1/.pattern3), 2y];
  NCTest[(exp2/.pattern3), x+y];

  pattern4=__**b_->b;
  NCTest[(exp1/.pattern4), 2y];
  NCTest[(exp2/.pattern4), x+y];

  Clear[zz];

  (* Test delayed rule *)

  Clear[zz];
  SNC[zz];

  pattern1=zz_**b_:>b**zz;
  exp1=x**y+x**y**y;
  NCTest[(exp1/.pattern1), y**x+x**y**y];

  zz=2;
  exp1=x**y+x**y**y;
  NCTest[(exp1/.pattern1), y**x+x**y**y];

  exp2=y**x+x**y**y;
  NCTest[(exp2/.pattern1), x**y+x**y**y];

  pattern2=_**b_:>b;
  NCTest[(exp1/.pattern2), y+x**y**y];
  NCTest[(exp2/.pattern2), x+x**y**y];

  pattern3=__**b_:>b;
  NCTest[(exp1/.pattern3), 2y];
  NCTest[(exp2/.pattern3), x+y];

  pattern4=__**b_:>b;
  NCTest[(exp1/.pattern4), 2y];
  NCTest[(exp2/.pattern4), x+y];

  Clear[zz];

  (* Test exceptions *)
  
  NCTestCheck[SetNonCommutative[1],
              CommutativeQ::NonCommutative];
  NCTestCheck[SetNonCommutative[Subscript[zz,1]],
              CommutativeQ::NonCommutativeSubscript];
  NCTestCheck[SetNonCommutative[f[x]],
              CommutativeQ::NonCommutative];
  NCTestCheck[SetNonCommutative[x + y],
              CommutativeQ::NonCommutative];

  NCTestCheck[SetCommutative[1],
              CommutativeQ::Commutative];
  NCTestCheck[SetCommutative[Subscript[zz,1]],
              CommutativeQ::CommutativeSubscript];
  NCTestCheck[SetCommutative[f[x]],
              CommutativeQ::Commutative];
  NCTestCheck[SetCommutative[x + y],
              CommutativeQ::Commutative];

  (* Test subscripts *)
  SetNonCommutative[zz];

  NCCheck[NonCommutativeQ[zz], True];
  NCCheck[NonCommutativeQ[Subscript[zz,1]], True];
  NCCheck[NonCommutativeQ[Subscript[zz,1,2]], True];
  NCCheck[NonCommutativeQ[Subscript[zz,x]], True];

  SetCommutative[zz];

  NCCheck[CommutativeQ[zz], True];
  NCCheck[CommutativeQ[Subscript[zz,1]], True];
  NCCheck[CommutativeQ[Subscript[zz,1,2]], True];
  NCCheck[CommutativeQ[Subscript[zz,x]], True];

  Clear[zz];
  
];