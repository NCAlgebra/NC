<< NCPolyInterface`
<< NCPoly`
<< NCPolySOS`

Block[
  {x,y,z,answer, symbol,
   vars, p, poly1, q, SDPVars, chipset,
   p1, p2, p1t, p2t,
   q1, Q1, Q, sol, solQ},

  q[ij__] := Subscript[q, ij];
  z[ij__] := Subscript[z, ij];
    
  SetNonCommutative[x,y];

  (* Test #1 *)

  vars = {x,y};
  p = (x+y-x**x);
  poly1 = NCToNCPoly[p**p+A x**y**y**x+B x**x,vars];

  {q1,Q1,symbol,chipset}=NCPolySOS[poly1];
  NCTest[StringContainsQ[ToString[symbol], "$"], True];
  answer = NCPoly[{1,
  1}, <|{0, 2, 0} -> q[2, 2], {0, 3, 0} ->
   2 q[4, 2], {0, 4, 0} -> q[4, 4], {1, 1, 1} ->
   q[3, 2], {1, 1, 2} -> q[3, 2], {1, 2, 1} ->
   q[4, 3], {1, 2, 2} -> 2 q[5, 2], {1, 2, 4} ->
   q[4, 3], {1, 3, 2} -> q[5, 4], {1, 3, 4} ->
   q[5, 4], {2, 0, 3} -> q[3, 3], {2, 1, 3} ->
   q[5, 3], {2, 1, 6} -> q[5, 3], {2, 2, 6} ->
   q[5, 5]|>] /. q -> symbol;
  NCTest[q1, answer];
  answer = SparseArray[{{2, 2} -> q[2, 2], {2, 3} -> q[3, 2], {2, 4} ->
   q[4, 2], {2, 5} -> q[5, 2], {3, 2} ->
  q[3, 2], {3, 3} -> q[3, 3], {3, 4} ->
  q[4, 3], {3, 5} -> q[5, 3], {4, 2} ->
  q[4, 2], {4, 3} -> q[4, 3], {4, 4} ->
  q[4, 4], {4, 5} -> q[5, 4], {5, 2} ->
  q[5, 2], {5, 3} -> q[5, 3], {5, 4} ->
  q[5, 4], {5, 5} -> q[5, 5], {_, _} -> 0} /. q -> symbol];
  NCTest[Q1, answer];

  {q1,Q1,symbol,chipset}=NCPolySOS[poly1, q];
  NCTest[symbol, q];
  answer = NCPoly[{1, 
  1}, <|{0, 2, 0} -> q[2, 2], {0, 3, 0} -> 
   2 q[4, 2], {0, 4, 0} -> q[4, 4], {1, 1, 1} ->
    q[3, 2], {1, 1, 2} -> q[3, 2], {1, 2, 1} -> 
   q[4, 3], {1, 2, 2} -> 2 q[5, 2], {1, 2, 4} ->
    q[4, 3], {1, 3, 2} -> q[5, 4], {1, 3, 4} -> 
   q[5, 4], {2, 0, 3} -> q[3, 3], {2, 1, 3} -> 
   q[5, 3], {2, 1, 6} -> q[5, 3], {2, 2, 6} -> 
   q[5, 5]|>];
  NCTest[q1, answer];
  answer = SparseArray[{{2, 2} -> q[2, 2], {2, 3} -> q[3, 2], {2, 4} ->
   q[4, 2], {2, 5} -> q[5, 2], {3, 2} -> 
  q[3, 2], {3, 3} -> q[3, 3], {3, 4} -> 
  q[4, 3], {3, 5} -> q[5, 3], {4, 2} -> 
  q[4, 2], {4, 3} -> q[4, 3], {4, 4} -> 
  q[4, 4], {4, 5} -> q[5, 4], {5, 2} -> 
  q[5, 2], {5, 3} -> q[5, 3], {5, 4} -> 
  q[5, 4], {5, 5} -> q[5, 5], {_, _} -> 0}];
  NCTest[Q1, answer];
  
  {Q,SDPVars,sol,solQ}=NCPolySOSToSDP[{poly1-q1},{Q1},z];
  answer = SparseArray[{{1, 1, 1} -> z[2], {1, 1, 2} -> 
    1, {1, 1, 3} -> -1, {1, 2, 1} -> 1, {1, 2, 2} -> 
    1, {1, 2, 3} -> -1, {1, 3, 1} -> -1, {1, 3, 2} -> -1, {1, 3, 3} -> 
    1, {1, 4, 4} -> z[1], {_, _, _} -> 0}];
  NCTest[Q, answer];
  NCTest[SDPVars, {z[1], z[2]}];
  NCTest[sol, {A -> z[1], B -> -1 + z[2]}];
  NCTest[solQ, {q[2, 2] -> z[2], 
   q[3, 2] -> 1, q[3, 3] -> 1, 
   q[4, 2] -> -1, q[4, 3] -> -1, 
   q[4, 4] -> 1, q[5, 2] -> 0, 
   q[5, 3] -> 0, q[5, 4] -> 0, 
   q[5, 5] -> z[1]}];

  (* Test #2 *)

  vars={x,y};
  p=(x+y-x**x)+(x-2y**x)+x**y**x**x;
  pt=tp[p]/.tp->Identity;
  poly1=NCToNCPoly[pt**p,vars];

  {q1,Q1,symbol,chipset}=NCPolySOS[poly1, q];
  NCTest[symbol, q];
  NCTest[q1, NCPoly[{1, 
    1}, <|{0, 2, 0} -> q[2, 2], {0, 3, 0} -> 
     2 q[4, 2], {0, 4, 0} -> q[4, 4], {1, 1, 1} ->
      q[3, 2], {1, 1, 2} -> q[3, 2], {1, 2, 1} -> 
     q[4, 3], {1, 2, 2} -> 2 q[5, 2], {1, 2, 4} ->
      q[4, 3], {1, 3, 2} -> 
     q[5, 4] + q[9, 2], {1, 3, 4} -> 
     q[5, 4] + q[9, 2], {1, 4, 4} -> 
     2 q[9, 4] + 2 q[18, 2], {1, 5, 4} -> 
     q[18, 4], {1, 5, 8} -> q[18, 4], {2, 0, 3} ->
      q[3, 3], {2, 1, 3} -> q[5, 3], {2, 1, 6} -> 
     q[5, 3], {2, 2, 3} -> q[9, 3], {2, 2, 6} -> 
     q[5, 5], {2, 2, 12} -> q[9, 3], {2, 3, 5} -> 
     q[18, 3], {2, 3, 6} -> q[9, 5], {2, 3, 12} ->
      q[9, 5], {2, 3, 20} -> q[18, 
     3], {2, 4, 10} -> q[18, 5], {2, 4, 12} -> q[
     9, 9], {2, 4, 20} -> q[18, 5], {2, 5, 20} -> 
     2 q[18, 9], {2, 6, 36} -> q[18, 18]|>]];
  NCTest[Q1, SparseArray[{{2, 2} -> q[2, 2], {2, 3} -> q[3, 2], {2, 4} ->
     q[4, 2], {2, 5} -> q[5, 2], {2, 9} -> 
    q[9, 2], {2, 18} -> q[18, 2], {3, 2} -> 
    q[3, 2], {3, 3} -> q[3, 3], {3, 4} -> 
    q[4, 3], {3, 5} -> q[5, 3], {3, 9} -> 
    q[9, 3], {3, 18} -> q[18, 3], {4, 2} -> 
    q[4, 2], {4, 3} -> q[4, 3], {4, 4} -> 
    q[4, 4], {4, 5} -> q[5, 4], {4, 9} -> 
    q[9, 4], {4, 18} -> q[18, 4], {5, 2} -> 
    q[5, 2], {5, 3} -> q[5, 3], {5, 4} -> 
    q[5, 4], {5, 5} -> q[5, 5], {5, 9} -> 
    q[9, 5], {5, 18} -> q[18, 5], {9, 2} -> 
    q[9, 2], {9, 3} -> q[9, 3], {9, 4} -> 
    q[9, 4], {9, 5} -> q[9, 5], {9, 9} -> 
    q[9, 9], {9, 18} -> q[18, 9], {18, 2} -> 
    q[18, 2], {18, 3} -> q[18, 3], {18, 4} -> 
    q[18, 4], {18, 5} -> q[18, 5], {18, 9} -> 
    q[18, 9], {18, 18} -> q[18, 18], {_, _} -> 0}
  ]];

  {Q,SDPVars,sol,solQ}=NCPolySOSToSDP[{poly1-q1},{Q1},z];
  NCTest[Q, SparseArray[{{1, 1, 1} -> 4, {1, 1, 2} -> 
    2, {1, 1, 3} -> -2, {1, 1, 4} -> -4, {1, 1, 5} -> 2, {1, 2, 1} -> 
    2, {1, 2, 2} -> 1, {1, 2, 3} -> -1, {1, 2, 4} -> -2, {1, 2, 5} -> 
    1, {1, 3, 1} -> -2, {1, 3, 2} -> -1, {1, 3, 3} -> 1, {1, 3, 4} -> 
    2, {1, 3, 5} -> -1, {1, 4, 1} -> -4, {1, 4, 2} -> -2, {1, 4, 3} -> 
    2, {1, 4, 4} -> 4, {1, 4, 5} -> -2, {1, 5, 1} -> 2, {1, 5, 2} -> 
    1, {1, 5, 3} -> -1, {1, 5, 4} -> -2, {1, 5, 5} -> 1, {_, _, _} -> 0}]];
  NCTest[SDPVars, {}];
  NCTest[sol, {}];
  NCTest[solQ, {q[2, 2] -> 4, q[3, 2] -> 2, 
   q[3, 3] -> 1, q[4, 2] -> -2, 
   q[4, 3] -> -1, q[4, 4] -> 1, 
   q[5, 2] -> -4, q[5, 3] -> -2, 
   q[5, 4] -> 2, q[5, 5] -> 4, 
   q[9, 2] -> 0, q[9, 3] -> 0, 
   q[9, 4] -> 0, q[9, 5] -> 0, 
   q[9, 9] -> 0, q[18, 2] -> 2, 
   q[18, 3] -> 1, q[18, 4] -> -1, 
   q[18, 5] -> -2, q[18, 9] -> 0, 
   q[18, 18] -> 1}];

  (* Test #3 *)
  
  vars = {x, y};
  p1 = (x + y - x ** x) + (x - 2 y ** x) + x ** y ** x ** x;
  p2 = (x + y - x ** x) ** (x - x ** y + y ** y);
  p1t = tp[p1] /. tp -> Identity;
  p2t = tp[p2] /. tp -> Identity;
  poly1 = NCToNCPoly[p1t ** p1 + p2t ** p2, vars];

  {q1,Q1,symbol,chipset} = NCPolySOS[poly1, q];
  NCTest[symbol, q];
  NCTest[q1, NCPoly[{1, 
    1}, <|{0, 2, 0} -> q[2, 2], {0, 3, 0} -> 
     2 q[4, 2], {0, 4, 0} -> 
     q[4, 4] + 2 q[8, 2], {0, 5, 0} -> 
     2 q[8, 4], {0, 6, 0} -> q[8, 8], {1, 1, 1} ->
      q[3, 2], {1, 1, 2} -> q[3, 2], {1, 2, 1} -> 
     q[4, 3] + q[6, 2], {1, 2, 2} -> 
     2 q[5, 2], {1, 2, 4} -> 
     q[4, 3] + q[6, 2], {1, 3, 1} -> 
     q[6, 4] + q[8, 3] + q[12, 2], {1, 
      3, 2} -> q[5, 4] + q[9, 2], {1, 3, 4} -> 
     q[5, 4] + q[9, 2], {1, 3, 8} -> 
     q[6, 4] + q[8, 3] + q[12, 2], {1, 
      4, 1} -> 
     q[8, 6] + q[12, 4] + q[24, 2], {1,
       4, 2} -> q[8, 5], {1, 4, 4} -> 
     2 q[9, 4] + 2 q[18, 2], {1, 4, 8} -> 
     q[8, 5], {1, 4, 16} -> 
     q[8, 6] + q[12, 4] + q[24, 2], {1,
       5, 1} -> q[12, 8] + q[24, 4], {1, 5, 4} -> 
     q[9, 8] + q[18, 4], {1, 5, 8} -> 
     q[9, 8] + q[18, 4], {1, 5, 32} -> 
     q[12, 8] + q[24, 4], {1, 6, 1} -> q[24, 8], {1, 6, 4} -> q[18, 8], {1, 6, 16} -> 
     q[18, 8], {1, 6, 64} -> q[24, 
     8], {2, 0, 3} -> q[3, 3], {2, 1, 3} -> 
     q[5, 3] + q[7, 2], {2, 1, 5} -> 
     2 q[6, 3], {2, 1, 6} -> 
     q[5, 3] + q[7, 2], {2, 2, 3} -> 
     q[7, 4] + q[9, 3] + q[14, 2], {2, 
      2, 5} -> q[6, 5] + q[13, 2], {2, 2, 6} -> 
     q[5, 5], {2, 2, 9} -> 
     q[6, 6] + 2 q[12, 3], {2, 2, 10} -> 
     q[6, 5] + q[13, 2], {2, 2, 12} -> 
     q[7, 4] + q[9, 3] + q[14, 2], {2, 
      3, 3} -> 
     q[8, 7] + q[14, 4] + q[28, 2], {2,
       3, 5} -> 
     q[9, 6] + q[13, 4] + q[18, 3], {2,
       3, 6} -> q[9, 5], {2, 3, 9} -> q[12, 
     5], {2, 3, 12} -> q[9, 5], {2, 3, 17} -> 
     2 q[12, 6] + 2 q[24, 3], {2, 3, 18} -> 
     q[12, 5], {2, 3, 20} -> 
     q[9, 6] + q[13, 4] + q[18, 3], {2,
       3, 24} -> 
     q[8, 7] + q[14, 4] + q[28, 2], {2,
       4, 3} -> q[14, 8] + q[28, 4], {2, 4, 5} -> 
     q[13, 8], {2, 4, 9} -> 
     q[12, 9] + q[18, 6], {2, 4, 10} -> q[18, 5], {2, 4, 12} -> q[9, 9], {2, 4, 17} -> 
     q[24, 5], {2, 4, 20} -> q[18, 
     5], {2, 4, 33} -> 
     q[12, 12] + 2 q[24, 6], {2, 4, 34} -> 
     q[24, 5], {2, 4, 36} -> 
     q[12, 9] + q[18, 6], {2, 4, 40} -> q[13, 8], {2, 4, 48} -> 
     q[14, 8] + q[28, 4], {2, 5, 3} -> q[28, 8], {2, 5, 17} -> 
     q[18, 12] + q[24, 9], {2, 5, 20} -> 
     2 q[18, 9], {2, 5, 65} -> 
     2 q[24, 12], {2, 5, 68} -> 
     q[18, 12] + q[24, 9], {2, 5, 96} -> 
     q[28, 8], {2, 6, 33} -> q[24, 
     18], {2, 6, 36} -> q[18, 18], {2, 6, 129} -> q[24, 24], {2, 6, 132} -> q[24, 18], {3, 0, 7} -> 
     2 q[7, 3], {3, 1, 7} -> 
     q[7, 5] + q[15, 2], {3, 1, 11} -> 
     q[7, 6] + q[13, 3] + q[14, 3], {3,
       1, 13} -> 
     q[7, 6] + q[13, 3] + q[14, 3], {3,
       1, 14} -> q[7, 5] + q[15, 2], {3, 2, 7} -> 
     q[9, 7] + q[15, 4], {3, 2, 11} -> q[14, 5], {3, 2, 13} -> q[13, 5], {3, 2, 19} -> 
     q[12, 7] + q[14, 6] + q[28, 
      3], {3, 2, 21} -> 2 q[13, 6], {3, 2, 22} -> q[13, 5], {3, 2, 25} -> 
     q[12, 7] + q[14, 6] + q[28, 
      3], {3, 2, 26} -> q[14, 5], {3, 2, 28} -> 
     q[9, 7] + q[15, 4], {3, 3, 7} -> q[15, 8], {3, 3, 11} -> 
     q[14, 9] + q[18, 7], {3, 3, 13} -> q[13, 9], {3, 3, 19} -> q[28, 5], {3, 3, 35} -> 
     q[14, 12] + q[24, 7] + q[28, 
      6], {3, 3, 37} -> q[13, 12], {3, 3, 41} -> q[13, 12], {3, 3, 44} -> q[13, 9], {3, 3, 49} -> 
     q[14, 12] + q[24, 7] + q[28, 
      6], {3, 3, 50} -> q[28, 5], {3, 3, 52} -> 
     q[14, 9] + q[18, 7], {3, 3, 56} -> q[15, 8], {3, 4, 19} -> 
     q[18, 14] + q[28, 9], {3, 4, 21} -> 
     q[18, 13], {3, 4, 67} -> 
     q[24, 14] + q[28, 12], {3, 4, 69} -> 
     q[24, 13], {3, 4, 81} -> q[24, 
     13], {3, 4, 84} -> q[18, 13], {3, 4, 97} -> 
     q[24, 14] + q[28, 12], {3, 4, 100} -> 
     q[18, 14] + q[28, 9], {3, 5, 35} -> 
     q[28, 18], {3, 5, 131} -> q[28, 
     24], {3, 5, 193} -> q[28, 24], {3, 5, 196} -> q[28, 18], {4, 0, 15} -> 
     q[7, 7] + 2 q[15, 3], {4, 1, 15} -> 
     q[15, 5], {4, 1, 23} -> 
     q[13, 7] + q[15, 6], {4, 1, 27} -> 
     2 q[14, 7], {4, 1, 29} -> 
     q[13, 7] + q[15, 6], {4, 1, 30} -> q[15, 5], {4, 2, 15} -> q[15, 9], {4, 2, 39} -> 
     q[15, 12], {4, 2, 43} -> q[14, 
     13], {4, 2, 45} -> q[13, 13], {4, 2, 51} -> 
     q[14, 14] + 2 q[28, 7], {4, 2, 53} -> 
     q[14, 13], {4, 2, 57} -> q[15, 
     12], {4, 2, 60} -> q[15, 9], {4, 3, 23} -> q[
     18, 15], {4, 3, 71} -> q[24, 15], {4, 3, 83} -> 
     q[28, 13], {4, 3, 99} -> 
     2 q[28, 14], {4, 3, 101} -> q[28, 
     13], {4, 3, 113} -> q[24, 15], {4, 3, 116} -> q[18, 15], {4, 4, 195} -> q[28, 28], {5, 0, 31} -> 
     2 q[15, 7], {5, 1, 47} -> q[15, 
     13], {5, 1, 55} -> q[15, 14], {5, 1, 59} -> q[15, 14], {5, 1, 61} -> q[15, 13], {5, 2, 103} -> 
     q[28, 15], {5, 2, 115} -> q[28, 
     15], {6, 0, 63} -> q[15, 15]|>]];
  NCTest[Q1, SparseArray[{{2, 2} -> q[2, 2], {2, 3} -> q[3, 
    2], {2, 4} -> q[4, 2], {2, 5} -> q[5, 
    2], {2, 6} -> q[6, 2], {2, 7} -> q[7, 
    2], {2, 8} -> q[8, 2], {2, 9} -> q[9, 
    2], {2, 12} -> q[12, 2], {2, 13} -> q[13, 
    2], {2, 14} -> q[14, 2], {2, 15} -> q[15, 
    2], {2, 18} -> q[18, 2], {2, 24} -> q[24, 
    2], {2, 28} -> q[28, 2], {3, 2} -> q[3, 
    2], {3, 3} -> q[3, 3], {3, 4} -> q[4, 
    3], {3, 5} -> q[5, 3], {3, 6} -> q[6, 
    3], {3, 7} -> q[7, 3], {3, 8} -> q[8, 
    3], {3, 9} -> q[9, 3], {3, 12} -> q[12, 
    3], {3, 13} -> q[13, 3], {3, 14} -> q[14, 
    3], {3, 15} -> q[15, 3], {3, 18} -> q[18, 
    3], {3, 24} -> q[24, 3], {3, 28} -> q[28, 
    3], {4, 2} -> q[4, 2], {4, 3} -> q[4, 
    3], {4, 4} -> q[4, 4], {4, 5} -> q[5, 
    4], {4, 6} -> q[6, 4], {4, 7} -> q[7, 
    4], {4, 8} -> q[8, 4], {4, 9} -> q[9, 
    4], {4, 12} -> q[12, 4], {4, 13} -> q[13, 
    4], {4, 14} -> q[14, 4], {4, 15} -> q[15, 
    4], {4, 18} -> q[18, 4], {4, 24} -> q[24, 
    4], {4, 28} -> q[28, 4], {5, 2} -> q[5, 
    2], {5, 3} -> q[5, 3], {5, 4} -> q[5, 
    4], {5, 5} -> q[5, 5], {5, 6} -> q[6, 
    5], {5, 7} -> q[7, 5], {5, 8} -> q[8, 
    5], {5, 9} -> q[9, 5], {5, 12} -> q[12, 
    5], {5, 13} -> q[13, 5], {5, 14} -> q[14, 
    5], {5, 15} -> q[15, 5], {5, 18} -> q[18, 
    5], {5, 24} -> q[24, 5], {5, 28} -> q[28, 
    5], {6, 2} -> q[6, 2], {6, 3} -> q[6, 
    3], {6, 4} -> q[6, 4], {6, 5} -> q[6, 
    5], {6, 6} -> q[6, 6], {6, 7} -> q[7, 
    6], {6, 8} -> q[8, 6], {6, 9} -> q[9, 
    6], {6, 12} -> q[12, 6], {6, 13} -> q[13, 
    6], {6, 14} -> q[14, 6], {6, 15} -> q[15, 
    6], {6, 18} -> q[18, 6], {6, 24} -> q[24, 
    6], {6, 28} -> q[28, 6], {7, 2} -> q[7, 
    2], {7, 3} -> q[7, 3], {7, 4} -> q[7, 
    4], {7, 5} -> q[7, 5], {7, 6} -> q[7, 
    6], {7, 7} -> q[7, 7], {7, 8} -> q[8, 
    7], {7, 9} -> q[9, 7], {7, 12} -> q[12, 
    7], {7, 13} -> q[13, 7], {7, 14} -> q[14, 
    7], {7, 15} -> q[15, 7], {7, 18} -> q[18, 
    7], {7, 24} -> q[24, 7], {7, 28} -> q[28, 
    7], {8, 2} -> q[8, 2], {8, 3} -> q[8, 
    3], {8, 4} -> q[8, 4], {8, 5} -> q[8, 
    5], {8, 6} -> q[8, 6], {8, 7} -> q[8, 
    7], {8, 8} -> q[8, 8], {8, 9} -> q[9, 
    8], {8, 12} -> q[12, 8], {8, 13} -> q[13, 
    8], {8, 14} -> q[14, 8], {8, 15} -> q[15, 
    8], {8, 18} -> q[18, 8], {8, 24} -> q[24, 
    8], {8, 28} -> q[28, 8], {9, 2} -> q[9, 
    2], {9, 3} -> q[9, 3], {9, 4} -> q[9, 
    4], {9, 5} -> q[9, 5], {9, 6} -> q[9, 
    6], {9, 7} -> q[9, 7], {9, 8} -> q[9, 
    8], {9, 9} -> q[9, 9], {9, 12} -> q[12, 
    9], {9, 13} -> q[13, 9], {9, 14} -> q[14, 
    9], {9, 15} -> q[15, 9], {9, 18} -> q[18, 
    9], {9, 24} -> q[24, 9], {9, 28} -> q[28, 
    9], {12, 2} -> q[12, 2], {12, 3} -> q[12, 
    3], {12, 4} -> q[12, 4], {12, 5} -> q[12, 
    5], {12, 6} -> q[12, 6], {12, 7} -> q[12, 
    7], {12, 8} -> q[12, 8], {12, 9} -> q[12, 
    9], {12, 12} -> q[12, 12], {12, 13} -> q[13, 
    12], {12, 14} -> q[14, 12], {12, 15} -> q[15, 
    12], {12, 18} -> q[18, 12], {12, 24} -> q[24, 
    12], {12, 28} -> q[28, 12], {13, 2} -> q[13, 
    2], {13, 3} -> q[13, 3], {13, 4} -> q[13, 
    4], {13, 5} -> q[13, 5], {13, 6} -> q[13, 
    6], {13, 7} -> q[13, 7], {13, 8} -> q[13, 
    8], {13, 9} -> q[13, 9], {13, 12} -> q[13, 
    12], {13, 13} -> q[13, 13], {13, 14} -> q[14, 
    13], {13, 15} -> q[15, 13], {13, 18} -> q[18, 
    13], {13, 24} -> q[24, 13], {13, 28} -> q[28, 
    13], {14, 2} -> q[14, 2], {14, 3} -> q[14, 
    3], {14, 4} -> q[14, 4], {14, 5} -> q[14, 
    5], {14, 6} -> q[14, 6], {14, 7} -> q[14, 
    7], {14, 8} -> q[14, 8], {14, 9} -> q[14, 
    9], {14, 12} -> q[14, 12], {14, 13} -> q[14, 
    13], {14, 14} -> q[14, 14], {14, 15} -> q[15, 
    14], {14, 18} -> q[18, 14], {14, 24} -> q[24, 
    14], {14, 28} -> q[28, 14], {15, 2} -> q[15, 
    2], {15, 3} -> q[15, 3], {15, 4} -> q[15, 
    4], {15, 5} -> q[15, 5], {15, 6} -> q[15, 
    6], {15, 7} -> q[15, 7], {15, 8} -> q[15, 
    8], {15, 9} -> q[15, 9], {15, 12} -> q[15, 
    12], {15, 13} -> q[15, 13], {15, 14} -> q[15, 
    14], {15, 15} -> q[15, 15], {15, 18} -> q[18, 
    15], {15, 24} -> q[24, 15], {15, 28} -> q[28, 
    15], {18, 2} -> q[18, 2], {18, 3} -> q[18, 
    3], {18, 4} -> q[18, 4], {18, 5} -> q[18, 
    5], {18, 6} -> q[18, 6], {18, 7} -> q[18, 
    7], {18, 8} -> q[18, 8], {18, 9} -> q[18, 
    9], {18, 12} -> q[18, 12], {18, 13} -> q[18, 
    13], {18, 14} -> q[18, 14], {18, 15} -> q[18, 
    15], {18, 18} -> q[18, 18], {18, 24} -> q[24, 
    18], {18, 28} -> q[28, 18], {24, 2} -> q[24, 
    2], {24, 3} -> q[24, 3], {24, 4} -> q[24, 
    4], {24, 5} -> q[24, 5], {24, 6} -> q[24, 
    6], {24, 7} -> q[24, 7], {24, 8} -> q[24, 
    8], {24, 9} -> q[24, 9], {24, 12} -> q[24, 
    12], {24, 13} -> q[24, 13], {24, 14} -> q[24, 
    14], {24, 15} -> q[24, 15], {24, 18} -> q[24, 
    18], {24, 24} -> q[24, 24], {24, 28} -> q[28, 
    24], {28, 2} -> q[28, 2], {28, 3} -> q[28, 
    3], {28, 4} -> q[28, 4], {28, 5} -> q[28, 
    5], {28, 6} -> q[28, 6], {28, 7} -> q[28, 
    7], {28, 8} -> q[28, 8], {28, 9} -> q[28, 
    9], {28, 12} -> q[28, 12], {28, 13} -> q[28, 
    13], {28, 14} -> q[28, 14], {28, 15} -> q[28, 
    15], {28, 18} -> q[28, 18], {28, 24} -> q[28, 
    24], {28, 28} -> q[28, 28], {_, _} -> 0}]];

  {Q, SDPVars, sol, solQ} = NCPolySOSToSDP[{poly1 - q1}, {Q1}, z];
  NCTest[Q, SparseArray[{{1, 1, 1} -> 4, {1, 1, 2} -> 
    2, {1, 1, 3} -> -2, {1, 1, 4} -> -4, {1, 1, 5} -> z[
    1], {1, 1, 6} -> z[2], {1, 1, 7} -> z[
    3], {1, 1, 8} -> z[5], {1, 1, 9} -> z[
    8], {1, 1, 10} -> z[11], {1, 1, 11} -> z[
    15], {1, 1, 12} -> 2, {1, 1, 13} -> z[18], {1, 1, 14} -> 
    z[23], {1, 2, 1} -> 2, {1, 2, 2} -> 
    1, {1, 2, 3} -> -1 - z[1], {1, 2, 4} -> -2 - z[2], {1, 2, 7} -> z[4], {1, 2, 8} -> z[
    6], {1, 2, 9} -> z[9], {1, 2, 10} -> z[
    12], {1, 2, 11} -> z[
    16], {1, 2, 12} -> -z[10], {1, 2, 13} -> z[
    19], {1, 2, 14} -> z[
    24], {1, 3, 1} -> -2, {1, 3, 2} -> -1 - z[1], {1, 3, 
     3} -> 2 - 2 z[3], {1, 3, 4} -> 
    3, {1, 3, 5} -> -z[4] - z[5], {1, 3, 
     6} -> -z[11], {1, 3, 7} -> -1, {1, 3, 8} -> z[7], {1, 3, 9} -> z[10], {1, 3, 10} -> z[
    13], {1, 3, 11} -> 1, {1, 3, 12} -> -1, {1, 3, 13} -> z[
    20], {1, 3, 14} -> z[
    25], {1, 4, 1} -> -4, {1, 4, 2} -> -2 - z[2], {1, 4, 
     3} -> 3, {1, 4, 4} -> 
    5, {1, 4, 5} -> -z[8], {1, 4, 6} -> -z[
     15], {1, 4, 7} -> -1, {1, 4, 8} -> -1, {1, 4, 9} -> -1, {1, 4, 
     10} -> 1, {1, 4, 11} -> 1, {1, 4, 12} -> -2, {1, 4, 13} -> 
    1, {1, 4, 14} -> -1, {1, 5, 1} -> z[
    1], {1, 5, 3} -> -z[4] - z[5], {1, 5, 
     4} -> -z[8], {1, 5, 5} -> -2 z[6], {1, 5, 
     6} -> -z[9] - z[12], {1, 5, 7} -> -1 - 
     z[7] - z[18], {1, 5, 8} -> -z[
     19], {1, 5, 10} -> z[14], {1, 5, 11} -> z[
    17], {1, 5, 13} -> z[21], {1, 5, 14} -> z[
    26], {1, 6, 1} -> z[
    2], {1, 6, 3} -> -z[11], {1, 6, 4} -> -z[
     15], {1, 6, 5} -> -z[9] - z[12], {1, 6, 
     6} -> -2 z[16], {1, 6, 7} -> 
    1 - z[13] - z[23], {1, 6, 
     8} -> -z[14] - z[24], {1, 6, 
     9} -> -z[17], {1, 6, 13} -> z[
    22], {1, 6, 14} -> z[27], {1, 7, 1} -> z[
    3], {1, 7, 2} -> z[
    4], {1, 7, 3} -> -1, {1, 7, 4} -> -1, {1, 7, 5} -> -1 - z[7] - z[18], {1, 7, 6} -> 
    1 - z[13] - z[23], {1, 7, 7} -> 
    1, {1, 7, 8} -> 2 - z[20], {1, 7, 9} -> 
    1, {1, 7, 10} -> -2 - z[25], {1, 7, 11} -> -1, {1, 7, 
     13} -> -1, {1, 7, 14} -> 1, {1, 8, 1} -> z[
    5], {1, 8, 2} -> z[6], {1, 8, 3} -> z[
    7], {1, 8, 4} -> -1, {1, 8, 5} -> -z[19], {1, 8, 
     6} -> -z[14] - z[24], {1, 8, 7} -> 
    2 - z[20], {1, 8, 8} -> 
    1 - 2 z[21], {1, 8, 9} -> 
    1, {1, 8, 10} -> -1 - z[22] - z[26], {1, 8, 
     11} -> -1, {1, 8, 13} -> -1, {1, 8, 14} -> z[
    28], {1, 9, 1} -> z[8], {1, 9, 2} -> z[
    9], {1, 9, 3} -> z[
    10], {1, 9, 4} -> -1, {1, 9, 6} -> -z[17], {1, 9, 7} -> 
    1, {1, 9, 8} -> 1, {1, 9, 9} -> 
    1, {1, 9, 10} -> -1, {1, 9, 11} -> -1, {1, 9, 13} -> -1, {1, 9, 
     14} -> 1, {1, 10, 1} -> z[11], {1, 10, 2} -> z[12], {1, 10, 3} -> z[13], {1, 10, 4} -> 
    1, {1, 10, 5} -> z[
    14], {1, 10, 7} -> -2 - z[25], {1, 10, 8} -> -1 - 
     z[22] - z[26], {1, 10, 9} -> -1, {1, 10, 
     10} -> 1 - 2 z[27], {1, 10, 11} -> 1, {1, 10, 13} -> 
    2 - z[28], {1, 10, 14} -> -1, {1, 11, 1} -> z[
    15], {1, 11, 2} -> z[16], {1, 11, 3} -> 1, {1, 11, 4} -> 
    1, {1, 11, 5} -> z[
    17], {1, 11, 7} -> -1, {1, 11, 8} -> -1, {1, 11, 9} -> -1, {1, 11, 
     10} -> 1, {1, 11, 11} -> 1, {1, 11, 13} -> 
    1, {1, 11, 14} -> -1, {1, 12, 1} -> 
    2, {1, 12, 2} -> -z[10], {1, 12, 3} -> -1, {1, 12, 
     4} -> -2, {1, 12, 12} -> 1, {1, 13, 1} -> z[
    18], {1, 13, 2} -> z[19], {1, 13, 3} -> z[
    20], {1, 13, 4} -> 1, {1, 13, 5} -> z[21], {1, 13, 6} -> 
    z[
    22], {1, 13, 7} -> -1, {1, 13, 8} -> -1, {1, 13, 9} -> -1, {1, 13, 
     10} -> 2 - z[28], {1, 13, 11} -> 1, {1, 13, 13} -> 
    1, {1, 13, 14} -> -1, {1, 14, 1} -> z[23], {1, 14, 2} -> 
    z[24], {1, 14, 3} -> z[
    25], {1, 14, 4} -> -1, {1, 14, 5} -> z[26], {1, 14, 6} ->
     z[27], {1, 14, 7} -> 1, {1, 14, 8} -> z[
    28], {1, 14, 9} -> 
    1, {1, 14, 10} -> -1, {1, 14, 11} -> -1, {1, 14, 13} -> -1, {1, 14, 
     14} -> 1, {_, _, _} -> 0}]];
  NCTest[SDPVars, {z[1], z[2], z[3], \
    z[4], z[5], z[6], z[7], \
    z[8], z[9], z[10], z[11], \
    z[12], z[13], z[14], z[\
    15], z[16], z[17], z[18], \
    z[19], z[20], z[21], z[\
    22], z[23], z[24], z[25], \
    z[26], z[27], z[28]}];
  NCTest[sol, {}];
  NCTest[solQ, {q[2, 2] -> 4, q[3, 2] -> 2, 
    q[3, 3] -> 1, q[4, 2] -> -2, 
    q[4, 3] -> -1 - z[1], 
    q[4, 4] -> 2 - 2 z[3], 
    q[5, 2] -> -4, q[5, 3] -> -2 - z[2],
     q[5, 4] -> 3, q[5, 5] -> 5, 
    q[6, 2] -> z[1], q[6, 3] -> 0, 
    q[6, 4] -> -z[4] - z[5], 
    q[6, 5] -> -z[8], 
    q[6, 6] -> -2 z[6], 
    q[7, 2] -> z[2], q[7, 3] -> 0, 
    q[7, 4] -> -z[11], 
    q[7, 5] -> -z[15], 
    q[7, 6] -> -z[9] - z[12], 
    q[7, 7] -> -2 z[16], 
    q[8, 2] -> z[3], 
    q[8, 3] -> z[4], q[8, 4] -> -1, 
    q[8, 5] -> -1, 
    q[8, 6] -> -1 - z[7] - z[18], 
    q[8, 7] -> 1 - z[13] - z[23], 
    q[8, 8] -> 1, q[9, 2] -> 0, 
    q[9, 3] -> 0, q[9, 4] -> 0, 
    q[9, 5] -> 0, q[9, 6] -> 0, 
    q[9, 7] -> 0, q[9, 8] -> 0, 
    q[9, 9] -> 0, q[12, 2] -> z[5], 
    q[12, 3] -> z[6], 
    q[12, 4] -> z[7], q[12, 5] -> -1, 
    q[12, 6] -> -z[19], 
    q[12, 7] -> -z[14] - z[24], 
    q[12, 8] -> 2 - z[20], 
    q[12, 9] -> 0, 
    q[12, 12] -> 1 - 2 z[21], 
    q[13, 2] -> z[8], 
    q[13, 3] -> z[9], 
    q[13, 4] -> z[10], q[13, 5] -> -1, 
    q[13, 6] -> 0, q[13, 7] -> -z[17], 
    q[13, 8] -> 1, q[13, 9] -> 0, 
    q[13, 12] -> 1, q[13, 13] -> 1, 
    q[14, 2] -> z[11], 
    q[14, 3] -> z[12], 
    q[14, 4] -> z[13], q[14, 5] -> 1, 
    q[14, 6] -> z[14], q[14, 7] -> 0, 
    q[14, 8] -> -2 - z[25], 
    q[14, 9] -> 0, 
    q[14, 12] -> -1 - z[22] - z[26], 
    q[14, 13] -> -1, 
    q[14, 14] -> 1 - 2 z[27], 
    q[15, 2] -> z[15], 
    q[15, 3] -> z[16], q[15, 4] -> 1, 
    q[15, 5] -> 1, q[15, 6] -> z[17], 
    q[15, 7] -> 0, q[15, 8] -> -1, 
    q[15, 9] -> 0, q[15, 12] -> -1, 
    q[15, 13] -> -1, q[15, 14] -> 1, 
    q[15, 15] -> 1, q[18, 2] -> 2, 
    q[18, 3] -> -z[10], q[18, 4] -> -1, 
    q[18, 5] -> -2, q[18, 6] -> 0, 
    q[18, 7] -> 0, q[18, 8] -> 0, 
    q[18, 9] -> 0, q[18, 12] -> 0, 
    q[18, 13] -> 0, q[18, 14] -> 0, 
    q[18, 15] -> 0, q[18, 18] -> 1, 
    q[24, 2] -> z[18], 
    q[24, 3] -> z[19], 
    q[24, 4] -> z[20], q[24, 5] -> 1, 
    q[24, 6] -> z[21], 
    q[24, 7] -> z[22], q[24, 8] -> -1, 
    q[24, 9] -> 0, q[24, 12] -> -1, 
    q[24, 13] -> -1, 
    q[24, 14] -> 2 - z[28], 
    q[24, 15] -> 1, q[24, 18] -> 0, 
    q[24, 24] -> 1, q[28, 2] -> z[23], 
    q[28, 3] -> z[24], 
    q[28, 4] -> z[25], q[28, 5] -> -1, 
    q[28, 6] -> z[26], 
    q[28, 7] -> z[27], q[28, 8] -> 1, 
    q[28, 9] -> 0, q[28, 12] -> z[28], 
    q[28, 13] -> 1, q[28, 14] -> -1, 
    q[28, 15] -> -1, q[28, 18] -> 0, 
    q[28, 24] -> -1, q[28, 28] -> 1}];

];
